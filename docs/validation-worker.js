!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);throw(f=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",f}c=n[i]={exports:{}},e[i][0].call(c.exports,function(r){return o(e[i][1][r]||r)},c,c.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.validateDOW=exports.nameDOW=exports.DOWPresets=void 0,exports.DOWPresets=[["MTWT___","____F__","_____S_","______S"],["MTWTF__","_____S_","______S"],["MTWTFSS"],["M______","_TWT___","____F__","_____S_","______S"],["M______","_TWTF__","_____S_","______S"],["M______","_T_____","__W____","___T___","____F__","_____S_","______S"]];const DOWNames={M______:"Mon",_T_____:"Tue",__W____:"Wed",___T___:"Thu",____F__:"Fri",_____S_:"Sat",______S:"Sun",MTWT___:"Mon-Thu",MTWTF__:"Mon-Fri",MTWTFSS:"Mon-Sun",_TWT___:"Tue-Thu",_TWTF__:"Tue-Fri"};exports.nameDOW=function(_){if(_ in DOWNames)return DOWNames[_];throw new Error(`Days of week value "${_}" is invalid or not supported`)},exports.validateDOW=function(_){if(/^(M|_)(T|_)(W|_)(T|_)(F|_)(S|_)(S|_)$/.test(_))return _;throw new Error(`Invalid days of week value: "${_}"`)}},{}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Network=void 0;exports.Network=class Network{constructor(t="api.trainarrives.in"){this.domain=t,this._json=null}async load(){const t=await fetch(`https://${this.domain}/network/v1`);if(200!=t.status)throw new Error(`"${this.domain}" did not respond.`);this._json=await t.json()}get lines(){if(null==this._json)throw new Error("Network not loaded.");return this._json.lines}stopName(t){if(null==this._json)throw new Error("Network not loaded.");var o=this._json.stops.find(o=>o.id===t);if(null==o)throw new Error("No stop with id="+t);return o.name}line(t){return this._json.lines.find(o=>o.id==t)}directionsForLine(t){return this._json.lines.find(o=>o.id==t).directions}toJSON(){return{domain:this.domain,json:this._json}}static fromJSON(t){const o=new Network(t.domain);return o._json=t.json,o}}},{}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Service=exports.TimetableData=void 0;exports.TimetableData=class TimetableData{constructor(e=[]){this._services=e.map(e=>e.clone())}cell(e,s){return this._services[e].times[s]}service(e){return this._services[e].clone()}nextDay(e){return this._services[e].nextDay}map(e){return this._services.map(s=>e(s.clone()))}addServices(e,s){null==s?this._services.push(...e.map(e=>e.clone())):this._services.splice(s,0,...e.map(e=>e.clone()))}deleteServices(e,s){null==s?this._services.splice(e,1):this._services.splice(e,s-e)}replaceService(e,s){this._services[s]=e.clone()}replaceCell(e,s,t){this._services[e].times[s]=t}modifyCell(e,s,t){this._services[e].times[s]=t(this._services[e].times[s])}modifyCells(e,s,t,i,r){for(let c=Math.min(e,t);c<=Math.max(e,t);c++)for(let e=Math.min(s,i);e<=Math.max(s,i);e++)this._services[c].times[e]=r(this._services[c].times[e],c,e)}setNextDay(e,s){this._services[e].nextDay=s}clone(){return new TimetableData(this._services)}get width(){return this._services.length}toJSON(){return{services:this._services}}static fromJSON(e){return new TimetableData(e.services.map(e=>Service.fromJSON(e)))}};class Service{constructor(e,s){this.times=e,this.nextDay=s}clone(){return new Service([...this.times],this.nextDay)}static fromJSON(e){return new Service(e.times,e.nextDay)}}exports.Service=Service},{}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TimetableSection=void 0;const dow_1=require("./dow"),timetable_data_1=require("./timetable-data");exports.TimetableSection=class TimetableSection{constructor(t,e,a){this.generalDir=t,this.dow=(0,dow_1.validateDOW)(e),this._data=new timetable_data_1.TimetableData,this.stops=a,this.undoFrames=[],this.redoFrames=[]}edit(t,e){for(this.undoFrames.push({actionName:t,before:this._data});10<this.undoFrames.length;)this.undoFrames.shift();this.redoFrames=[],t=this._data.clone(),e(t),this._data=t,this.changed&&this.changed()}undo(){var t=this.undoFrames.pop();return null==t?null:(this.redoFrames.push({actionName:t.actionName,after:this._data}),this._data=t.before,this.changed&&this.changed(),t.actionName)}redo(){var t=this.redoFrames.pop();return null==t?null:(this.undoFrames.push({actionName:t.actionName,before:this._data}),this._data=t.after,this.changed&&this.changed(),t.actionName)}cell(t,e){return this._data.cell(t,e)}service(t){return this._data.service(t)}nextDay(t){return this._data.nextDay(t)}map(t){return this._data.map(t)}toJSON(){return{generalDir:this.generalDir,dow:this.dow,stops:this.stops,data:this._data.toJSON()}}static fromJSON(t){const e=new TimetableSection(t.generalDir,t.dow,t.stops);return e._data=timetable_data_1.TimetableData.fromJSON(t.data),e}get width(){return this._data.width}get height(){return this.stops.length}}},{"./dow":1,"./timetable-data":3}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ValidationResults=exports.validateSection=exports.isValidTimetable=void 0;const utils_1=require("../utils");function validateSection(r,e,t){var s=new ValidationResults(r.width,r.height);return function(r,e){for(const t of(0,utils_1.range)(0,r.height))(0,utils_1.range)(0,r.width).some(e=>""==r.cell(e,t))&&e.reportStopError(t,"Stop has missing values")}(r,s),function(r,e){for(const t of(0,utils_1.range)(0,r.width)){const s=r.service(t);for(const i of(0,utils_1.range)(0,t)){const o=r.service(i);s.nextDay==o.nextDay&&s.times.every((r,e)=>r==o.times[e])&&e.reportServiceError(t,"Duplicated service")}}}(r,s),function(r,e,t,s){var i=e.line(t);for(const e of(0,utils_1.range)(0,r.width)){const t=r.service(e),o=/((2[0-3])|([01][0-9]):[0-5][0-9])|-/;if(t.times.every(r=>""==r||o.test(r))){if(!t.times.some(r=>""==r)){const o=function(r,e,t){const s=r.filter((r,t)=>"-"!=e.times[t]),i=t.filter(r=>s.every(e=>r.stops.includes(e)));return 0==i.length?null:i.sort((r,e)=>r.stops.length-e.stops.length)[0].id}(r.stops,t,i.directions);null==o?s.reportServiceError(e,"Service direction unrecognized"):s.reportServiceDirection(e,function(r,e){return"city-loop"===e.routeType?r.endsWith("-via-loop")?e.routeLoopPortal+"-via-loop":e.routeLoopPortal+"-direct":"branch"===e.routeType&&2==e.directions.length?r===e.directions[0].id?"branch-a":"branch-b":null}(o,i))}}else s.reportServiceError(e,"Cells contain invalid values")}}(r,e,t,s),s}exports.isValidTimetable=function(r,e){return r.sections.every(t=>validateSection(t,e,r.lineID).isValid())},exports.validateSection=validateSection;class ValidationResults{constructor(r,e){this.stopErrors=(0,utils_1.repeat)(null,e),this.serviceErrors=(0,utils_1.repeat)(null,r),this.nextDayThresholds=(0,utils_1.repeat)(5,r),this.directionsIcons=(0,utils_1.repeat)(null,r)}reportStopError(r,e){this.stopErrors[r]=e}reportServiceError(r,e){this.serviceErrors[r]=e}reportServiceDirection(r,e){this.directionsIcons[r]=e}isValid(){return this.stopErrors.every(r=>null==r)&&this.serviceErrors.every(r=>null==r)}overallError(){let r=null;if(null==(r=null==(r=null==r?this.stopErrors.find(r=>null!=r):r)?this.serviceErrors.find(r=>null!=r):r))return null;var e=this.stopErrors.filter(r=>null!=r).length+this.serviceErrors.filter(r=>null!=r).length-1;return 0==e?r:1==e?r+" + 1 other error":r+` + ${e} other errors`}toJSON(){return{stopErrors:this.stopErrors,serviceErrors:this.serviceErrors,nextDayThresholds:this.nextDayThresholds,directionsIcons:this.directionsIcons}}static fromJSON(r){const e=new ValidationResults(r.serviceErrors.length,r.stopErrors.length);return e.stopErrors=r.stopErrors,e.serviceErrors=r.serviceErrors,e.nextDayThresholds=r.nextDayThresholds,e.directionsIcons=r.directionsIcons,e}}exports.ValidationResults=ValidationResults},{"../utils":6}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.repeat=exports.range=exports.clamp=exports.validateLineID=exports.validateTimetableID=void 0,exports.validateTimetableID=function(e){if(isNaN(e))throw new Error("No timetable ID given");if(1295<e||e<0)throw new Error("Timetable ID must be 0-1295 to fit within two base-36 "+`digits (given ${e})`);return e},exports.validateLineID=function(e,t){if(t.lines.every(t=>t.id!==e))throw new Error("There is no line with id="+e);return e},exports.clamp=function(e,t,r){var a=Math.min(t,r),t=Math.max(t,r);return Math.min(Math.max(e,a),t)},exports.range=function(e,t){return[...Array(t-e).keys()].map(t=>t+e)},exports.repeat=function(e,t){const r=[];for(let a=0;a<t;a++)r.push(e);return r}},{}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const network_1=require("./data/network"),timetable_section_1=require("./data/timetable-section"),timetable_validation_1=require("./data/timetable-validation");let network=null;onmessage=e=>{if(e.data.network)network=network_1.Network.fromJSON(e.data.network);else if(null!=network){const t=timetable_section_1.TimetableSection.fromJSON(e.data.section),a=e.data.lineID,o=(0,timetable_validation_1.validateSection)(t,network,a);postMessage(o.toJSON())}}},{"./data/network":2,"./data/timetable-section":4,"./data/timetable-validation":5}]},{},[7]);
