!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);throw(f=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",f}c=n[i]={exports:{}},e[i][0].call(c.exports,function(r){return o(e[i][1][r]||r)},c,c.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getErrorMap=exports.setErrorMap=exports.defaultErrorMap=exports.ZodError=exports.quotelessJson=exports.ZodIssueCode=void 0;const parseUtil_1=require("./helpers/parseUtil"),util_1=require("./helpers/util");exports.ZodIssueCode=util_1.util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of"]);exports.quotelessJson=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class ZodError extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};var r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const r=e||function(e){return e.message},t={_errors:[]},s=e=>{for(const i of e.issues)if("invalid_union"===i.code)i.unionErrors.map(s);else if("invalid_return_type"===i.code)s(i.returnTypeError);else if("invalid_arguments"===i.code)s(i.argumentsError);else if(0===i.path.length)t._errors.push(r(i));else{let e=t,s=0;for(;s<i.path.length;){const t=i.path[s];s===i.path.length-1?(e[t]=e[t]||{_errors:[]},e[t]._errors.push(r(i))):e[t]=e[t]||{_errors:[]},e=e[t],s++}}};return s(this),t}toString(){return this.message}get message(){return JSON.stringify(this.issues,parseUtil_1.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const r={},t=[];for(const s of this.issues)0<s.path.length?(r[s.path[0]]=r[s.path[0]]||[],r[s.path[0]].push(e(s))):t.push(e(s));return{formErrors:t,fieldErrors:r}}get formErrors(){return this.flatten()}}(exports.ZodError=ZodError).create=e=>new ZodError(e);exports.defaultErrorMap=(e,r)=>{let t;switch(e.code){case exports.ZodIssueCode.invalid_type:t=e.received===util_1.ZodParsedType.undefined?"Required":`Expected ${e.expected}, received `+e.received;break;case exports.ZodIssueCode.invalid_literal:t="Invalid literal value, expected "+JSON.stringify(e.expected,parseUtil_1.jsonStringifyReplacer);break;case exports.ZodIssueCode.unrecognized_keys:t="Unrecognized key(s) in object: "+util_1.util.joinValues(e.keys,", ");break;case exports.ZodIssueCode.invalid_union:t="Invalid input";break;case exports.ZodIssueCode.invalid_union_discriminator:t="Invalid discriminator value. Expected "+util_1.util.joinValues(e.options);break;case exports.ZodIssueCode.invalid_enum_value:t=`Invalid enum value. Expected ${util_1.util.joinValues(e.options)}, received '${e.received}'`;break;case exports.ZodIssueCode.invalid_arguments:t="Invalid function arguments";break;case exports.ZodIssueCode.invalid_return_type:t="Invalid function return type";break;case exports.ZodIssueCode.invalid_date:t="Invalid date";break;case exports.ZodIssueCode.invalid_string:"object"==typeof e.validation?"startsWith"in e.validation?t=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?t=`Invalid input: must start with "${e.validation.endsWith}"`:util_1.util.assertNever(e.validation):t="regex"!==e.validation?"Invalid "+e.validation:"Invalid";break;case exports.ZodIssueCode.too_small:t="array"===e.type?`Array must contain ${e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?"Number must be greater than "+(e.inclusive?"or equal to ":"")+e.minimum:"Invalid input";break;case exports.ZodIssueCode.too_big:t="array"===e.type?`Array must contain ${e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?"Number must be less than "+(e.inclusive?"or equal to ":"")+e.maximum:"Invalid input";break;case exports.ZodIssueCode.custom:t="Invalid input";break;case exports.ZodIssueCode.invalid_intersection_types:t="Intersection results could not be merged";break;case exports.ZodIssueCode.not_multiple_of:t="Number must be a multiple of "+e.multipleOf;break;default:t=r.defaultError,util_1.util.assertNever(e)}return{message:t}};let overrideErrorMap=exports.defaultErrorMap;exports.setErrorMap=function(e){overrideErrorMap=e},exports.getErrorMap=function(){return overrideErrorMap}},{"./helpers/parseUtil":4,"./helpers/util":6}],2:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,r,t,o){void 0===o&&(o=t),Object.defineProperty(e,o,{enumerable:!0,get:function(){return r[t]}})}:function(e,r,t,o){e[o=void 0===o?t:o]=r[t]}),__exportStar=this&&this.__exportStar||function(e,r){for(var t in e)"default"===t||Object.prototype.hasOwnProperty.call(r,t)||__createBinding(r,e,t)},util_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.ZodParsedType=exports.getParsedType=void 0,__exportStar(require("./helpers/parseUtil"),exports),__exportStar(require("./helpers/typeAliases"),exports),require("./helpers/util"));Object.defineProperty(exports,"getParsedType",{enumerable:!0,get:function(){return util_1.getParsedType}}),Object.defineProperty(exports,"ZodParsedType",{enumerable:!0,get:function(){return util_1.ZodParsedType}}),__exportStar(require("./types"),exports),__exportStar(require("./ZodError"),exports)},{"./ZodError":1,"./helpers/parseUtil":4,"./helpers/typeAliases":5,"./helpers/util":6,"./types":8}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.errorUtil=void 0,(exports=exports.errorUtil||(exports.errorUtil={})).errToObj=r=>"string"==typeof r?{message:r}:r||{},exports.toString=r=>"string"==typeof r?r:null==r?void 0:r.message},{}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.jsonStringifyReplacer=exports.isAsync=exports.isValid=exports.isDirty=exports.isAborted=exports.OK=exports.DIRTY=exports.INVALID=exports.ParseStatus=exports.addIssueToContext=exports.EMPTY_PATH=exports.makeIssue=void 0;const ZodError_1=require("../ZodError");exports.makeIssue=t=>{const{data:s,path:e,errorMaps:r,issueData:a}=t,o=[...e,...a.path||[]],i={...a,path:o};let u="";var n=r.filter(t=>!!t).slice().reverse();for(const t of n)u=t(i,{data:s,defaultError:u}).message;return{...a,path:o,message:a.message||u}},exports.EMPTY_PATH=[],exports.addIssueToContext=function(t,s){s=exports.makeIssue({issueData:s,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ZodError_1.getErrorMap(),ZodError_1.defaultErrorMap].filter(t=>!!t)}),t.common.issues.push(s)};class ParseStatus{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(t,s){const e=[];for(const r of s){if("aborted"===r.status)return exports.INVALID;"dirty"===r.status&&t.dirty(),e.push(r.value)}return{status:t.value,value:e}}static async mergeObjectAsync(t,s){const e=[];for(const t of s)e.push({key:await t.key,value:await t.value});return ParseStatus.mergeObjectSync(t,e)}static mergeObjectSync(t,s){const e={};for(const r of s){const{key:s,value:a}=r;if("aborted"===s.status)return exports.INVALID;if("aborted"===a.status)return exports.INVALID;"dirty"===s.status&&t.dirty(),"dirty"===a.status&&t.dirty(),void 0===a.value&&!r.alwaysSet||(e[s.value]=a.value)}return{status:t.value,value:e}}}exports.ParseStatus=ParseStatus,exports.INVALID=Object.freeze({status:"aborted"});exports.DIRTY=t=>({status:"dirty",value:t}),exports.OK=t=>({status:"valid",value:t}),exports.isAborted=t=>"aborted"===t.status,exports.isDirty=t=>"dirty"===t.status,exports.isValid=t=>"valid"===t.status,exports.isAsync=t=>t instanceof Promise;exports.jsonStringifyReplacer=(t,s)=>"bigint"==typeof s?s.toString():s},{"../ZodError":1}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0})},{}],6:[function(require,module,exports){"use strict";var util,e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.getParsedType=exports.ZodParsedType=exports.util=void 0,(e=util=exports.util||(exports.util={})).assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const r of e)t[r]=r;return t},e.getValidEnumValues=t=>{const r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),o={};for(const e of r)o[e]=t[e];return e.objectValues(o)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(const r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},exports.ZodParsedType=util.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]);exports.getParsedType=e=>{switch(typeof e){case"undefined":return exports.ZodParsedType.undefined;case"string":return exports.ZodParsedType.string;case"number":return isNaN(e)?exports.ZodParsedType.nan:exports.ZodParsedType.number;case"boolean":return exports.ZodParsedType.boolean;case"function":return exports.ZodParsedType.function;case"bigint":return exports.ZodParsedType.bigint;case"object":return Array.isArray(e)?exports.ZodParsedType.array:null===e?exports.ZodParsedType.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?exports.ZodParsedType.promise:"undefined"!=typeof Map&&e instanceof Map?exports.ZodParsedType.map:"undefined"!=typeof Set&&e instanceof Set?exports.ZodParsedType.set:"undefined"!=typeof Date&&e instanceof Date?exports.ZodParsedType.date:exports.ZodParsedType.object;default:return exports.ZodParsedType.unknown}}},{}],7:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){e[o=void 0===o?r:o]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__exportStar=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||__createBinding(t,e,r)},__importStar=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.z=void 0,__importStar(require("./external")));exports.z=__importStar,__exportStar(require("./external"),exports),exports.default=__importStar},{"./external":2}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.intersection=exports.instanceof=exports.function=exports.enum=exports.effect=exports.discriminatedUnion=exports.date=exports.boolean=exports.bigint=exports.array=exports.any=exports.ZodFirstPartyTypeKind=exports.late=exports.ZodSchema=exports.Schema=exports.custom=exports.ZodNaN=exports.ZodDefault=exports.ZodNullable=exports.ZodOptional=exports.ZodTransformer=exports.ZodEffects=exports.ZodPromise=exports.ZodNativeEnum=exports.ZodEnum=exports.ZodLiteral=exports.ZodLazy=exports.ZodFunction=exports.ZodSet=exports.ZodMap=exports.ZodRecord=exports.ZodTuple=exports.ZodIntersection=exports.ZodDiscriminatedUnion=exports.ZodUnion=exports.ZodObject=exports.objectUtil=exports.ZodArray=exports.ZodVoid=exports.ZodNever=exports.ZodUnknown=exports.ZodAny=exports.ZodNull=exports.ZodUndefined=exports.ZodDate=exports.ZodBoolean=exports.ZodBigInt=exports.ZodNumber=exports.ZodString=exports.ZodType=void 0,exports.void=exports.unknown=exports.union=exports.undefined=exports.tuple=exports.transformer=exports.string=exports.strictObject=exports.set=exports.record=exports.promise=exports.preprocess=exports.ostring=exports.optional=exports.onumber=exports.oboolean=exports.object=exports.number=exports.nullable=exports.null=exports.never=exports.nativeEnum=exports.nan=exports.map=exports.literal=exports.lazy=void 0;const errorUtil_1=require("./helpers/errorUtil"),parseUtil_1=require("./helpers/parseUtil"),util_1=require("./helpers/util"),ZodError_1=require("./ZodError");class ParseInputLazyPath{constructor(e,t,r,s){this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._path.concat(this._key)}}const handleResult=(e,t)=>{if(parseUtil_1.isValid(t))return{success:!0,data:t.value};if(e.common.issues.length)return{success:!1,error:new ZodError_1.ZodError(e.common.issues)};throw new Error("Validation failed but no issues detected.")};function processCreateParams(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:s,description:a}=e;if(t&&(r||s))throw new Error('Can\'t use "invalid" or "required" in conjunction with custom error map.');return t?{errorMap:t,description:a}:{errorMap:(t,r)=>"invalid_type"!==t.code?{message:r.defaultError}:void 0===r.data&&s?{message:s}:e.invalid_type_error?{message:e.invalid_type_error}:{message:r.defaultError},description:a}}class ZodType{constructor(e){this.spa=this.safeParseAsync,this.superRefine=this._refinement,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.default=this.default.bind(this),this.describe=this.describe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return util_1.getParsedType(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:util_1.getParsedType(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new parseUtil_1.ParseStatus,ctx:{common:e.parent.common,data:e.data,parsedType:util_1.getParsedType(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){e=this._parse(e);if(parseUtil_1.isAsync(e))throw new Error("Synchronous parse encountered promise.");return e}_parseAsync(e){e=this._parse(e);return Promise.resolve(e)}parse(e,t){e=this.safeParse(e,t);if(e.success)return e.data;throw e.error}safeParse(e,t){var r={common:{issues:[],async:null!=(r=null==t?void 0:t.async)&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:util_1.getParsedType(e)},t=this._parseSync({data:e,path:r.path,parent:r});return handleResult(r,t)}async parseAsync(e,t){e=await this.safeParseAsync(e,t);if(e.success)return e.data;throw e.error}async safeParseAsync(e,t){t={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:util_1.getParsedType(e)},e=this._parse({data:e,path:[],parent:t}),e=await(parseUtil_1.isAsync(e)?e:Promise.resolve(e));return handleResult(t,e)}refine(e,t){const r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,s)=>{const a=e(t),o=()=>s.addIssue({code:ZodError_1.ZodIssueCode.custom,...r(t)});return"undefined"!=typeof Promise&&a instanceof Promise?a.then(e=>!!e||(o(),!1)):!!a||(o(),!1)})}refinement(e,t){return this._refinement((r,s)=>!!e(r)||(s.addIssue("function"==typeof t?t(r,s):t),!1))}_refinement(e){return new ZodEffects({schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"refinement",refinement:e}})}optional(){return ZodOptional.create(this)}nullable(){return ZodNullable.create(this)}nullish(){return this.optional().nullable()}array(){return ZodArray.create(this)}promise(){return ZodPromise.create(this)}or(e){return ZodUnion.create([this,e])}and(e){return ZodIntersection.create(this,e)}transform(e){return new ZodEffects({schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new ZodDefault({innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:ZodFirstPartyTypeKind.ZodDefault})}describe(e){return new this.constructor({...this._def,description:e})}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}exports.ZodType=ZodType,exports.Schema=ZodType,exports.ZodSchema=ZodType;const cuidRegex=/^c[^\s-]{8,}$/i,uuidRegex=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,emailRegex=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;class ZodString extends ZodType{constructor(){super(...arguments),this._regex=(e,t,r)=>this.refinement(t=>e.test(t),{validation:t,code:ZodError_1.ZodIssueCode.invalid_string,...errorUtil_1.errorUtil.errToObj(r)}),this.nonempty=e=>this.min(1,errorUtil_1.errorUtil.errToObj(e)),this.trim=()=>new ZodString({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}_parse(e){if(this._getType(e)!==util_1.ZodParsedType.string){const t=this._getOrReturnCtx(e);return parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.string,received:t.parsedType}),parseUtil_1.INVALID}const t=new parseUtil_1.ParseStatus;let r=void 0;for(const s of this._def.checks)if("min"===s.kind)e.data.length<s.value&&(r=this._getOrReturnCtx(e,r),parseUtil_1.addIssueToContext(r,{code:ZodError_1.ZodIssueCode.too_small,minimum:s.value,type:"string",inclusive:!0,message:s.message}),t.dirty());else if("max"===s.kind)e.data.length>s.value&&(r=this._getOrReturnCtx(e,r),parseUtil_1.addIssueToContext(r,{code:ZodError_1.ZodIssueCode.too_big,maximum:s.value,type:"string",inclusive:!0,message:s.message}),t.dirty());else if("email"===s.kind)emailRegex.test(e.data)||(r=this._getOrReturnCtx(e,r),parseUtil_1.addIssueToContext(r,{validation:"email",code:ZodError_1.ZodIssueCode.invalid_string,message:s.message}),t.dirty());else if("uuid"===s.kind)uuidRegex.test(e.data)||(r=this._getOrReturnCtx(e,r),parseUtil_1.addIssueToContext(r,{validation:"uuid",code:ZodError_1.ZodIssueCode.invalid_string,message:s.message}),t.dirty());else if("cuid"===s.kind)cuidRegex.test(e.data)||(r=this._getOrReturnCtx(e,r),parseUtil_1.addIssueToContext(r,{validation:"cuid",code:ZodError_1.ZodIssueCode.invalid_string,message:s.message}),t.dirty());else if("url"===s.kind)try{new URL(e.data)}catch(a){r=this._getOrReturnCtx(e,r),parseUtil_1.addIssueToContext(r,{validation:"url",code:ZodError_1.ZodIssueCode.invalid_string,message:s.message}),t.dirty()}else"regex"===s.kind?(s.regex.lastIndex=0,s.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),parseUtil_1.addIssueToContext(r,{validation:"regex",code:ZodError_1.ZodIssueCode.invalid_string,message:s.message}),t.dirty())):"trim"===s.kind?e.data=e.data.trim():"startsWith"===s.kind?e.data.startsWith(s.value)||(r=this._getOrReturnCtx(e,r),parseUtil_1.addIssueToContext(r,{code:ZodError_1.ZodIssueCode.invalid_string,validation:{startsWith:s.value},message:s.message}),t.dirty()):"endsWith"===s.kind?e.data.endsWith(s.value)||(r=this._getOrReturnCtx(e,r),parseUtil_1.addIssueToContext(r,{code:ZodError_1.ZodIssueCode.invalid_string,validation:{endsWith:s.value},message:s.message}),t.dirty()):util_1.util.assertNever(s);return{status:t.value,value:e.data}}_addCheck(e){return new ZodString({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...errorUtil_1.errorUtil.errToObj(e)})}url(e){return this._addCheck({kind:"url",...errorUtil_1.errorUtil.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...errorUtil_1.errorUtil.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...errorUtil_1.errorUtil.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...errorUtil_1.errorUtil.errToObj(t)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...errorUtil_1.errorUtil.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...errorUtil_1.errorUtil.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...errorUtil_1.errorUtil.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...errorUtil_1.errorUtil.errToObj(t)})}length(e,t){return this.min(e,t).max(e,t)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}(exports.ZodString=ZodString).create=e=>new ZodString({checks:[],typeName:ZodFirstPartyTypeKind.ZodString,...processCreateParams(e)});class ZodNumber extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._getType(e)!==util_1.ZodParsedType.number){const t=this._getOrReturnCtx(e);return parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.number,received:t.parsedType}),parseUtil_1.INVALID}let t=void 0;const r=new parseUtil_1.ParseStatus;for(const s of this._def.checks)"int"===s.kind?util_1.util.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):"min"===s.kind?(s.inclusive?e.data<s.value:e.data<=s.value)&&(t=this._getOrReturnCtx(e,t),parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,message:s.message}),r.dirty()):"max"===s.kind?(s.inclusive?e.data>s.value:e.data>=s.value)&&(t=this._getOrReturnCtx(e,t),parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,message:s.message}),r.dirty()):"multipleOf"===s.kind?0!==function(e,t){var r=(e.toString().split(".")[1]||"").length,s=(t.toString().split(".")[1]||"").length,r=s<r?r:s;return parseInt(e.toFixed(r).replace(".",""))%parseInt(t.toFixed(r).replace(".",""))/Math.pow(10,r)}(e.data,s.value)&&(t=this._getOrReturnCtx(e,t),parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):util_1.util.assertNever(s);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,errorUtil_1.errorUtil.toString(t))}gt(e,t){return this.setLimit("min",e,!1,errorUtil_1.errorUtil.toString(t))}lte(e,t){return this.setLimit("max",e,!0,errorUtil_1.errorUtil.toString(t))}lt(e,t){return this.setLimit("max",e,!1,errorUtil_1.errorUtil.toString(t))}setLimit(e,t,r,s){return new ZodNumber({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:errorUtil_1.errorUtil.toString(s)}]})}_addCheck(e){return new ZodNumber({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:errorUtil_1.errorUtil.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:errorUtil_1.errorUtil.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:errorUtil_1.errorUtil.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:errorUtil_1.errorUtil.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:errorUtil_1.errorUtil.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:errorUtil_1.errorUtil.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind)}}(exports.ZodNumber=ZodNumber).create=e=>new ZodNumber({checks:[],typeName:ZodFirstPartyTypeKind.ZodNumber,...processCreateParams(e)});class ZodBigInt extends ZodType{_parse(e){var t;return this._getType(e)!==util_1.ZodParsedType.bigint?(t=this._getOrReturnCtx(e),parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.bigint,received:t.parsedType}),parseUtil_1.INVALID):parseUtil_1.OK(e.data)}}(exports.ZodBigInt=ZodBigInt).create=e=>new ZodBigInt({typeName:ZodFirstPartyTypeKind.ZodBigInt,...processCreateParams(e)});class ZodBoolean extends ZodType{_parse(e){var t;return this._getType(e)!==util_1.ZodParsedType.boolean?(t=this._getOrReturnCtx(e),parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.boolean,received:t.parsedType}),parseUtil_1.INVALID):parseUtil_1.OK(e.data)}}(exports.ZodBoolean=ZodBoolean).create=e=>new ZodBoolean({typeName:ZodFirstPartyTypeKind.ZodBoolean,...processCreateParams(e)});class ZodDate extends ZodType{_parse(e){var t;if(this._getType(e)!==util_1.ZodParsedType.date)return t=this._getOrReturnCtx(e),parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.date,received:t.parsedType}),parseUtil_1.INVALID;if(isNaN(e.data.getTime())){const t=this._getOrReturnCtx(e);return parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.invalid_date}),parseUtil_1.INVALID}return{status:"valid",value:new Date(e.data.getTime())}}}(exports.ZodDate=ZodDate).create=e=>new ZodDate({typeName:ZodFirstPartyTypeKind.ZodDate,...processCreateParams(e)});class ZodUndefined extends ZodType{_parse(e){var t;return this._getType(e)!==util_1.ZodParsedType.undefined?(t=this._getOrReturnCtx(e),parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.undefined,received:t.parsedType}),parseUtil_1.INVALID):parseUtil_1.OK(e.data)}}(exports.ZodUndefined=ZodUndefined).create=e=>new ZodUndefined({typeName:ZodFirstPartyTypeKind.ZodUndefined,...processCreateParams(e)});class ZodNull extends ZodType{_parse(e){var t;return this._getType(e)!==util_1.ZodParsedType.null?(t=this._getOrReturnCtx(e),parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.null,received:t.parsedType}),parseUtil_1.INVALID):parseUtil_1.OK(e.data)}}(exports.ZodNull=ZodNull).create=e=>new ZodNull({typeName:ZodFirstPartyTypeKind.ZodNull,...processCreateParams(e)});class ZodAny extends ZodType{constructor(){super(...arguments),this._any=!0}_parse(e){return parseUtil_1.OK(e.data)}}(exports.ZodAny=ZodAny).create=e=>new ZodAny({typeName:ZodFirstPartyTypeKind.ZodAny,...processCreateParams(e)});class ZodUnknown extends ZodType{constructor(){super(...arguments),this._unknown=!0}_parse(e){return parseUtil_1.OK(e.data)}}(exports.ZodUnknown=ZodUnknown).create=e=>new ZodUnknown({typeName:ZodFirstPartyTypeKind.ZodUnknown,...processCreateParams(e)});class ZodNever extends ZodType{_parse(e){e=this._getOrReturnCtx(e);return parseUtil_1.addIssueToContext(e,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.never,received:e.parsedType}),parseUtil_1.INVALID}}(exports.ZodNever=ZodNever).create=e=>new ZodNever({typeName:ZodFirstPartyTypeKind.ZodNever,...processCreateParams(e)});class ZodVoid extends ZodType{_parse(e){var t;return this._getType(e)!==util_1.ZodParsedType.undefined?(t=this._getOrReturnCtx(e),parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.void,received:t.parsedType}),parseUtil_1.INVALID):parseUtil_1.OK(e.data)}}(exports.ZodVoid=ZodVoid).create=e=>new ZodVoid({typeName:ZodFirstPartyTypeKind.ZodVoid,...processCreateParams(e)});class ZodArray extends ZodType{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==util_1.ZodParsedType.array)return parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.array,received:t.parsedType}),parseUtil_1.INVALID;if(null!==s.minLength&&t.data.length<s.minLength.value&&(parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,message:s.minLength.message}),r.dirty()),null!==s.maxLength&&t.data.length>s.maxLength.value&&(parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all(t.data.map((e,r)=>s.type._parseAsync(new ParseInputLazyPath(t,e,t.path,r)))).then(e=>parseUtil_1.ParseStatus.mergeArray(r,e));e=t.data.map((e,r)=>s.type._parseSync(new ParseInputLazyPath(t,e,t.path,r)));return parseUtil_1.ParseStatus.mergeArray(r,e)}get element(){return this._def.type}min(e,t){return new ZodArray({...this._def,minLength:{value:e,message:errorUtil_1.errorUtil.toString(t)}})}max(e,t){return new ZodArray({...this._def,maxLength:{value:e,message:errorUtil_1.errorUtil.toString(t)}})}length(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}var objectUtil;(exports.ZodArray=ZodArray).create=(e,t)=>new ZodArray({type:e,minLength:null,maxLength:null,typeName:ZodFirstPartyTypeKind.ZodArray,...processCreateParams(t)}),(objectUtil=exports.objectUtil||(exports.objectUtil={})).mergeShapes=(e,t)=>({...e,...t});const AugmentFactory=e=>t=>new ZodObject({...e,shape:()=>({...e.shape(),...t})});class ZodObject extends ZodType{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=AugmentFactory(this._def),this.extend=AugmentFactory(this._def)}_getCached(){if(null!==this._cached)return this._cached;var e=this._def.shape(),t=util_1.util.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==util_1.ZodParsedType.object){const t=this._getOrReturnCtx(e);return parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.object,received:t.parsedType}),parseUtil_1.INVALID}const{status:t,ctx:r}=this._processInputParams(e),{shape:s,keys:a}=this._getCached(),o=[];for(const e in r.data)a.includes(e)||o.push(e);const n=[];for(const e of a){const t=s[e],a=r.data[e];n.push({key:{status:"valid",value:e},value:t._parse(new ParseInputLazyPath(r,a,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof ZodNever){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of o)n.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)0<o.length&&(parseUtil_1.addIssueToContext(r,{code:ZodError_1.ZodIssueCode.unrecognized_keys,keys:o}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of o){const s=r.data[t];n.push({key:{status:"valid",value:t},value:e._parse(new ParseInputLazyPath(r,s,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const e=[];for(const t of n){var r=await t.key;e.push({key:r,value:await t.value,alwaysSet:t.alwaysSet})}return e}).then(e=>parseUtil_1.ParseStatus.mergeObjectSync(t,e)):parseUtil_1.ParseStatus.mergeObjectSync(t,n)}get shape(){return this._def.shape()}strict(e){return errorUtil_1.errorUtil.errToObj,new ZodObject({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var a,s=null!=(a=null==(a=(s=this._def).errorMap)?void 0:a.call(s,t,r).message)?a:r.defaultError;return"unrecognized_keys"===t.code?{message:null!=(a=errorUtil_1.errorUtil.errToObj(e).message)?a:s}:{message:s}}}:{}})}strip(){return new ZodObject({...this._def,unknownKeys:"strip"})}passthrough(){return new ZodObject({...this._def,unknownKeys:"passthrough"})}setKey(e,t){return this.augment({[e]:t})}merge(e){return new ZodObject({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>objectUtil.mergeShapes(this._def.shape(),e._def.shape()),typeName:ZodFirstPartyTypeKind.ZodObject})}catchall(e){return new ZodObject({...this._def,catchall:e})}pick(e){const t={};return util_1.util.objectKeys(e).map(e=>{this.shape[e]&&(t[e]=this.shape[e])}),new ZodObject({...this._def,shape:()=>t})}omit(e){const t={};return util_1.util.objectKeys(this.shape).map(r=>{-1===util_1.util.objectKeys(e).indexOf(r)&&(t[r]=this.shape[r])}),new ZodObject({...this._def,shape:()=>t})}deepPartial(){return function deepPartialify(e){if(e instanceof ZodObject){const t={};for(const r in e.shape){var s=e.shape[r];t[r]=ZodOptional.create(deepPartialify(s))}return new ZodObject({...e._def,shape:()=>t})}return e instanceof ZodArray?ZodArray.create(deepPartialify(e.element)):e instanceof ZodOptional?ZodOptional.create(deepPartialify(e.unwrap())):e instanceof ZodNullable?ZodNullable.create(deepPartialify(e.unwrap())):e instanceof ZodTuple?ZodTuple.create(e.items.map(e=>deepPartialify(e))):e}(this)}partial(e){const t={};if(e)return util_1.util.objectKeys(this.shape).map(r=>{-1===util_1.util.objectKeys(e).indexOf(r)?t[r]=this.shape[r]:t[r]=this.shape[r].optional()}),new ZodObject({...this._def,shape:()=>t});for(const e in this.shape){const r=this.shape[e];t[e]=r.optional()}return new ZodObject({...this._def,shape:()=>t})}required(){const e={};for(const t in this.shape){let r=this.shape[t];for(;r instanceof ZodOptional;)r=r._def.innerType;e[t]=r}return new ZodObject({...this._def,shape:()=>e})}}(exports.ZodObject=ZodObject).create=(e,t)=>new ZodObject({shape:()=>e,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(t)}),ZodObject.strictCreate=(e,t)=>new ZodObject({shape:()=>e,unknownKeys:"strict",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(t)}),ZodObject.lazycreate=(e,t)=>new ZodObject({shape:e,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(t)});class ZodUnion extends ZodType{_parse(e){const t=this._processInputParams(e)["ctx"],r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{var r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const r=e.map(e=>new ZodError_1.ZodError(e.ctx.common.issues));return parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.invalid_union,unionErrors:r}),parseUtil_1.INVALID});{let e=void 0;const s=[];for(const a of r){const r={...t,common:{...t.common,issues:[]},parent:null},o=a._parseSync({data:t.data,path:t.path,parent:r});if("valid"===o.status)return o;"dirty"!==o.status||e||(e={result:o,ctx:r}),r.common.issues.length&&s.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;var a=s.map(e=>new ZodError_1.ZodError(e));return parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.invalid_union,unionErrors:a}),parseUtil_1.INVALID}}get options(){return this._def.options}}(exports.ZodUnion=ZodUnion).create=(e,t)=>new ZodUnion({options:e,typeName:ZodFirstPartyTypeKind.ZodUnion,...processCreateParams(t)});class ZodDiscriminatedUnion extends ZodType{_parse(e){e=this._processInputParams(e).ctx;if(e.parsedType!==util_1.ZodParsedType.object)return parseUtil_1.addIssueToContext(e,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.object,received:e.parsedType}),parseUtil_1.INVALID;const r=this.discriminator,s=e.data[r],a=this.options.get(s);return a?e.common.async?a._parseAsync({data:e.data,path:e.path,parent:e}):a._parseSync({data:e.data,path:e.path,parent:e}):(parseUtil_1.addIssueToContext(e,{code:ZodError_1.ZodIssueCode.invalid_union_discriminator,options:this.validDiscriminatorValues,path:[r]}),parseUtil_1.INVALID)}get discriminator(){return this._def.discriminator}get validDiscriminatorValues(){return Array.from(this.options.keys())}get options(){return this._def.options}static create(e,t,r){const s=new Map;try{t.forEach(t=>{var r=t.shape[e].value;s.set(r,t)})}catch(e){throw new Error("The discriminator value could not be extracted from all the provided schemas")}if(s.size!==t.length)throw new Error("Some of the discriminator values are not unique");return new ZodDiscriminatedUnion({typeName:ZodFirstPartyTypeKind.ZodDiscriminatedUnion,discriminator:e,options:s,...processCreateParams(r)})}}exports.ZodDiscriminatedUnion=ZodDiscriminatedUnion;class ZodIntersection extends ZodType{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=(e,s)=>{if(parseUtil_1.isAborted(e)||parseUtil_1.isAborted(s))return parseUtil_1.INVALID;var a=function mergeValues(e,t){const r=util_1.getParsedType(e),s=util_1.getParsedType(t);if(e===t)return{valid:!0,data:e};if(r===util_1.ZodParsedType.object&&s===util_1.ZodParsedType.object){const r=util_1.util.objectKeys(t),s=util_1.util.objectKeys(e).filter(e=>-1!==r.indexOf(e)),a={...e,...t};for(const r of s){const s=mergeValues(e[r],t[r]);if(!s.valid)return{valid:!1};a[r]=s.data}return{valid:!0,data:a}}if(r!==util_1.ZodParsedType.array||s!==util_1.ZodParsedType.array)return r===util_1.ZodParsedType.date&&s===util_1.ZodParsedType.date&&+e==+t?{valid:!0,data:e}:{valid:!1};{if(e.length!==t.length)return{valid:!1};const r=[];for(let s=0;s<e.length;s++){var a=mergeValues(e[s],t[s]);if(!a.valid)return{valid:!1};r.push(a.data)}return{valid:!0,data:r}}}(e.value,s.value);return a.valid?((parseUtil_1.isDirty(e)||parseUtil_1.isDirty(s))&&t.dirty(),{status:t.value,value:a.data}):(parseUtil_1.addIssueToContext(r,{code:ZodError_1.ZodIssueCode.invalid_intersection_types}),parseUtil_1.INVALID)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>s(e,t)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}(exports.ZodIntersection=ZodIntersection).create=(e,t,r)=>new ZodIntersection({left:e,right:t,typeName:ZodFirstPartyTypeKind.ZodIntersection,...processCreateParams(r)});class ZodTuple extends ZodType{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==util_1.ZodParsedType.array)return parseUtil_1.addIssueToContext(r,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.array,received:r.parsedType}),parseUtil_1.INVALID;if(r.data.length<this._def.items.length)return parseUtil_1.addIssueToContext(r,{code:ZodError_1.ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,type:"array"}),parseUtil_1.INVALID;!this._def.rest&&r.data.length>this._def.items.length&&(parseUtil_1.addIssueToContext(r,{code:ZodError_1.ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,type:"array"}),t.dirty());e=r.data.map((e,t)=>{const s=this._def.items[t]||this._def.rest;return s?s._parse(new ParseInputLazyPath(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(e).then(e=>parseUtil_1.ParseStatus.mergeArray(t,e)):parseUtil_1.ParseStatus.mergeArray(t,e)}get items(){return this._def.items}rest(e){return new ZodTuple({...this._def,rest:e})}}(exports.ZodTuple=ZodTuple).create=(e,t)=>new ZodTuple({items:e,typeName:ZodFirstPartyTypeKind.ZodTuple,rest:null,...processCreateParams(t)});class ZodRecord extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){var{status:e,ctx:r}=this._processInputParams(e);if(r.parsedType!==util_1.ZodParsedType.object)return parseUtil_1.addIssueToContext(r,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.object,received:r.parsedType}),parseUtil_1.INVALID;const s=[],a=this._def.keyType,o=this._def.valueType;for(const e in r.data)s.push({key:a._parse(new ParseInputLazyPath(r,e,r.path,e)),value:o._parse(new ParseInputLazyPath(r,r.data[e],r.path,e))});return r.common.async?parseUtil_1.ParseStatus.mergeObjectAsync(e,s):parseUtil_1.ParseStatus.mergeObjectSync(e,s)}get element(){return this._def.valueType}static create(e,t,r){return new ZodRecord(t instanceof ZodType?{keyType:e,valueType:t,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(r)}:{keyType:ZodString.create(),valueType:e,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(t)})}}exports.ZodRecord=ZodRecord;class ZodMap extends ZodType{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==util_1.ZodParsedType.map)return parseUtil_1.addIssueToContext(r,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.map,received:r.parsedType}),parseUtil_1.INVALID;const s=this._def.keyType,a=this._def.valueType,o=[...r.data.entries()].map(([e,t],o)=>({key:s._parse(new ParseInputLazyPath(r,e,r.path,[o,"key"])),value:a._parse(new ParseInputLazyPath(r,t,r.path,[o,"value"]))}));if(r.common.async){const e=new Map;return Promise.resolve().then(async()=>{for(const r of o){var s=await r.key,a=await r.value;if("aborted"===s.status||"aborted"===a.status)return parseUtil_1.INVALID;"dirty"!==s.status&&"dirty"!==a.status||t.dirty(),e.set(s.value,a.value)}return{status:t.value,value:e}})}{const e=new Map;for(const r of o){const s=r.key,a=r.value;if("aborted"===s.status||"aborted"===a.status)return parseUtil_1.INVALID;"dirty"!==s.status&&"dirty"!==a.status||t.dirty(),e.set(s.value,a.value)}return{status:t.value,value:e}}}}(exports.ZodMap=ZodMap).create=(e,t,r)=>new ZodMap({valueType:t,keyType:e,typeName:ZodFirstPartyTypeKind.ZodMap,...processCreateParams(r)});class ZodSet extends ZodType{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==util_1.ZodParsedType.set)return parseUtil_1.addIssueToContext(r,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.set,received:r.parsedType}),parseUtil_1.INVALID;e=this._def;null!==e.minSize&&r.data.size<e.minSize.value&&(parseUtil_1.addIssueToContext(r,{code:ZodError_1.ZodIssueCode.too_small,minimum:e.minSize.value,type:"set",inclusive:!0,message:e.minSize.message}),t.dirty()),null!==e.maxSize&&r.data.size>e.maxSize.value&&(parseUtil_1.addIssueToContext(r,{code:ZodError_1.ZodIssueCode.too_big,maximum:e.maxSize.value,type:"set",inclusive:!0,message:e.maxSize.message}),t.dirty());const a=this._def.valueType;function o(e){const r=new Set;for(const s of e){if("aborted"===s.status)return parseUtil_1.INVALID;"dirty"===s.status&&t.dirty(),r.add(s.value)}return{status:t.value,value:r}}e=[...r.data.values()].map((e,t)=>a._parse(new ParseInputLazyPath(r,e,r.path,t)));return r.common.async?Promise.all(e).then(e=>o(e)):o(e)}min(e,t){return new ZodSet({...this._def,minSize:{value:e,message:errorUtil_1.errorUtil.toString(t)}})}max(e,t){return new ZodSet({...this._def,maxSize:{value:e,message:errorUtil_1.errorUtil.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}(exports.ZodSet=ZodSet).create=(e,t)=>new ZodSet({valueType:e,minSize:null,maxSize:null,typeName:ZodFirstPartyTypeKind.ZodSet,...processCreateParams(t)});class ZodFunction extends ZodType{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const t=this._processInputParams(e)["ctx"];if(t.parsedType!==util_1.ZodParsedType.function)return parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.function,received:t.parsedType}),parseUtil_1.INVALID;function r(e,r){return parseUtil_1.makeIssue({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ZodError_1.getErrorMap(),ZodError_1.defaultErrorMap].filter(e=>!!e),issueData:{code:ZodError_1.ZodIssueCode.invalid_arguments,argumentsError:r}})}function s(e,r){return parseUtil_1.makeIssue({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ZodError_1.getErrorMap(),ZodError_1.defaultErrorMap].filter(e=>!!e),issueData:{code:ZodError_1.ZodIssueCode.invalid_return_type,returnTypeError:r}})}const a={errorMap:t.common.contextualErrorMap},o=t.data;return this._def.returns instanceof ZodPromise?parseUtil_1.OK(async(...e)=>{const t=new ZodError_1.ZodError([]),n=await this._def.args.parseAsync(e,a).catch(s=>{throw t.addIssue(r(e,s)),t}),i=await o(...n);return this._def.returns._def.type.parseAsync(i,a).catch(e=>{throw t.addIssue(s(i,e)),t})}):parseUtil_1.OK((...e)=>{var t=this._def.args.safeParse(e,a);if(!t.success)throw new ZodError_1.ZodError([r(e,t.error)]);e=o(...t.data),t=this._def.returns.safeParse(e,a);if(t.success)return t.data;throw new ZodError_1.ZodError([s(e,t.error)])})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ZodFunction({...this._def,args:ZodTuple.create(e).rest(ZodUnknown.create())})}returns(e){return new ZodFunction({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}}(exports.ZodFunction=ZodFunction).create=(e,t,r)=>new ZodFunction({args:(e||ZodTuple.create([])).rest(ZodUnknown.create()),returns:t||ZodUnknown.create(),typeName:ZodFirstPartyTypeKind.ZodFunction,...processCreateParams(r)});class ZodLazy extends ZodType{get schema(){return this._def.getter()}_parse(e){e=this._processInputParams(e).ctx;return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}}(exports.ZodLazy=ZodLazy).create=(e,t)=>new ZodLazy({getter:e,typeName:ZodFirstPartyTypeKind.ZodLazy,...processCreateParams(t)});class ZodLiteral extends ZodType{_parse(e){var t;return e.data!==this._def.value?(t=this._getOrReturnCtx(e),parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.invalid_literal,expected:this._def.value}),parseUtil_1.INVALID):{status:"valid",value:e.data}}get value(){return this._def.value}}(exports.ZodLiteral=ZodLiteral).create=(e,t)=>new ZodLiteral({value:e,typeName:ZodFirstPartyTypeKind.ZodLiteral,...processCreateParams(t)});class ZodEnum extends ZodType{_parse(e){var t,r;if("string"!=typeof e.data)return t=this._getOrReturnCtx(e),r=this._def.values,parseUtil_1.addIssueToContext(t,{expected:util_1.util.joinValues(r),received:t.parsedType,code:ZodError_1.ZodIssueCode.invalid_type}),parseUtil_1.INVALID;if(-1!==this._def.values.indexOf(e.data))return parseUtil_1.OK(e.data);{const t=this._getOrReturnCtx(e),r=this._def.values;return parseUtil_1.addIssueToContext(t,{received:t.data,code:ZodError_1.ZodIssueCode.invalid_enum_value,options:r}),parseUtil_1.INVALID}}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}}(exports.ZodEnum=ZodEnum).create=function(e,t){return new ZodEnum({values:e,typeName:ZodFirstPartyTypeKind.ZodEnum,...processCreateParams(t)})};class ZodNativeEnum extends ZodType{_parse(e){const t=util_1.util.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==util_1.ZodParsedType.string&&r.parsedType!==util_1.ZodParsedType.number){const e=util_1.util.objectValues(t);return parseUtil_1.addIssueToContext(r,{expected:util_1.util.joinValues(e),received:r.parsedType,code:ZodError_1.ZodIssueCode.invalid_type}),parseUtil_1.INVALID}if(-1!==t.indexOf(e.data))return parseUtil_1.OK(e.data);{const e=util_1.util.objectValues(t);return parseUtil_1.addIssueToContext(r,{received:r.data,code:ZodError_1.ZodIssueCode.invalid_enum_value,options:e}),parseUtil_1.INVALID}}get enum(){return this._def.values}}(exports.ZodNativeEnum=ZodNativeEnum).create=(e,t)=>new ZodNativeEnum({values:e,typeName:ZodFirstPartyTypeKind.ZodNativeEnum,...processCreateParams(t)});class ZodPromise extends ZodType{_parse(e){const t=this._processInputParams(e)["ctx"];if(t.parsedType!==util_1.ZodParsedType.promise&&!1===t.common.async)return parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.promise,received:t.parsedType}),parseUtil_1.INVALID;const r=t.parsedType===util_1.ZodParsedType.promise?t.data:Promise.resolve(t.data);return parseUtil_1.OK(r.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}(exports.ZodPromise=ZodPromise).create=(e,t)=>new ZodPromise({type:e,typeName:ZodFirstPartyTypeKind.ZodPromise,...processCreateParams(t)});class ZodEffects extends ZodType{innerType(){return this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null;if("preprocess"===s.type){const e=s.transform(r.data);return r.common.async?Promise.resolve(e).then(e=>this._def.schema._parseAsync({data:e,path:r.path,parent:r})):this._def.schema._parseSync({data:e,path:r.path,parent:r})}const a={addIssue:e=>{parseUtil_1.addIssueToContext(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),"refinement"===s.type){const e=e=>{var t=s.refinement(e,a);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?parseUtil_1.INVALID:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{const s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===s.status?parseUtil_1.INVALID:("dirty"===s.status&&t.dirty(),e(s.value),{status:t.value,value:s.value})}}if("transform"===s.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>parseUtil_1.isValid(e)?Promise.resolve(s.transform(e.value,a)).then(e=>({status:t.value,value:e})):e);{const e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!parseUtil_1.isValid(e))return e;var o=s.transform(e.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}}util_1.util.assertNever(s)}}exports.ZodEffects=ZodEffects,(exports.ZodTransformer=ZodEffects).create=(e,t,r)=>new ZodEffects({schema:e,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:t,...processCreateParams(r)}),ZodEffects.createWithPreprocess=(e,t,r)=>new ZodEffects({schema:t,effect:{type:"preprocess",transform:e},typeName:ZodFirstPartyTypeKind.ZodEffects,...processCreateParams(r)});class ZodOptional extends ZodType{_parse(e){return this._getType(e)===util_1.ZodParsedType.undefined?parseUtil_1.OK(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}(exports.ZodOptional=ZodOptional).create=(e,t)=>new ZodOptional({innerType:e,typeName:ZodFirstPartyTypeKind.ZodOptional,...processCreateParams(t)});class ZodNullable extends ZodType{_parse(e){return this._getType(e)===util_1.ZodParsedType.null?parseUtil_1.OK(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}(exports.ZodNullable=ZodNullable).create=(e,t)=>new ZodNullable({innerType:e,typeName:ZodFirstPartyTypeKind.ZodNullable,...processCreateParams(t)});class ZodDefault extends ZodType{_parse(e){e=this._processInputParams(e).ctx;let r=e.data;return e.parsedType===util_1.ZodParsedType.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:e.path,parent:e})}removeDefault(){return this._def.innerType}}(exports.ZodDefault=ZodDefault).create=(e,t)=>new ZodOptional({innerType:e,typeName:ZodFirstPartyTypeKind.ZodOptional,...processCreateParams(t)});class ZodNaN extends ZodType{_parse(e){var t;return this._getType(e)!==util_1.ZodParsedType.nan?(t=this._getOrReturnCtx(e),parseUtil_1.addIssueToContext(t,{code:ZodError_1.ZodIssueCode.invalid_type,expected:util_1.ZodParsedType.nan,received:t.parsedType}),parseUtil_1.INVALID):{status:"valid",value:e.data}}}(exports.ZodNaN=ZodNaN).create=e=>new ZodNaN({typeName:ZodFirstPartyTypeKind.ZodNaN,...processCreateParams(e)});var ZodFirstPartyTypeKind;exports.custom=(e,t={},r)=>e?ZodAny.create().superRefine((s,a)=>{if(!e(s)){const e="function"==typeof t?t(s):t,o="string"==typeof e?{message:e}:e;a.addIssue({code:"custom",...o,fatal:r})}}):ZodAny.create(),exports.late={object:ZodObject.lazycreate},function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodPromise="ZodPromise"}(ZodFirstPartyTypeKind=exports.ZodFirstPartyTypeKind||(exports.ZodFirstPartyTypeKind={}));exports.instanceof=(e,t={message:"Input not instance of "+e.name})=>exports.custom(t=>t instanceof e,t,!0);const stringType=ZodString.create,numberType=(exports.string=stringType,ZodNumber.create);exports.number=numberType;require=ZodNaN.create,exports.nan=require,require=ZodBigInt.create;exports.bigint=require;const booleanType=ZodBoolean.create;exports.boolean=booleanType;require=ZodDate.create,exports.date=require,require=ZodUndefined.create,exports.undefined=require,require=ZodNull.create,exports.null=require,require=ZodAny.create,exports.any=require,require=ZodUnknown.create,exports.unknown=require,require=ZodNever.create,exports.never=require,require=ZodVoid.create,exports.void=require,require=ZodArray.create,exports.array=require,require=ZodObject.create,exports.object=require,require=ZodObject.strictCreate,exports.strictObject=require,require=ZodUnion.create,exports.union=require,require=ZodDiscriminatedUnion.create,exports.discriminatedUnion=require,require=ZodIntersection.create,exports.intersection=require,require=ZodTuple.create,exports.tuple=require,require=ZodRecord.create,exports.record=require,require=ZodMap.create,exports.map=require,require=ZodSet.create,exports.set=require,require=ZodFunction.create,exports.function=require,require=ZodLazy.create,exports.lazy=require,require=ZodLiteral.create,exports.literal=require,require=ZodEnum.create,exports.enum=require,require=ZodNativeEnum.create,exports.nativeEnum=require,require=ZodPromise.create,exports.promise=require,require=ZodEffects.create,exports.effect=require,exports.transformer=require,require=ZodOptional.create,exports.optional=require,require=ZodNullable.create,exports.nullable=require,require=ZodEffects.createWithPreprocess;exports.preprocess=require,exports.ostring=()=>stringType().optional(),exports.onumber=()=>numberType().optional();exports.oboolean=()=>booleanType().optional()},{"./ZodError":1,"./helpers/errorUtil":3,"./helpers/parseUtil":4,"./helpers/util":6}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AppContext=void 0;const editor_1=require("./editor/editor"),header_1=require("./components/header"),new_timetable_dialog_1=require("./components/new-timetable-dialog"),paste_issues_dialog_1=require("./components/paste-issues-dialog"),timetable_1=require("./data/timetable"),week_day_range_1=require("./data/week-day-range"),validator_1=require("./validator"),export_1=require("./data/export"),utils_1=require("./utils"),dom_utils_1=require("./dom-utils"),main_1=require("./main");exports.AppContext=class{constructor(e,t){this.network=e,this.timetable=null,this.status=t,this.validator=new validator_1.Validator(e,e=>this.onValidatorResults(e)),this.editor=new editor_1.Editor(e=>this.onValidationRequest(e)),this.header=new header_1.Header(()=>this.onNewButtonClicked(),()=>this.onExportButtonClicked()),this.newTimetableDialog=new new_timetable_dialog_1.NewTimetableDialog(e),this.pasteIssuesDialog=new paste_issues_dialog_1.PasteIssuesDialog,this.status.ready(),this.header.ready(),this.editor.clear()}onNewButtonClicked(){null!=this.timetable&&this.timetable.hasContent()&&!confirm("Create a new timetable? This one won't be saved anywhere.")||this.newTimetableDialog.show((e,t,i)=>this.onNTDSubmitted(e,t,i))}onExportButtonClicked(){try{if(null==this.timetable)throw new Error("Timetable is null, nothing to export.");(0,export_1.exportTimetable)(this.timetable,this.network)}catch(e){alert("Error: "+(0,utils_1.getErrorMessage)(e))}}onNTDSubmitted(e,t,i){i=parseInt(i,36),t=week_day_range_1.WDRPresets[t],i=new timetable_1.Timetable(i,e,t,this.network);this.editTimetable(i)}editTimetable(e){this.timetable=e,this.header.editing(e.generalDirs,e.wdrs,(t,i)=>{t=e.getTimetableSection(t,i);this.editor.setSection(t,this.network)}),this.status.editing();var t=e.getFirstSection();this.editor.setSection(t,this.network),this.header.selectTab(t.generalDir,t.wdr)}onValidationRequest(e){null!=this.timetable&&this.validator.requestValidation(e,this.timetable.lineID)}onValidatorResults(e){const t=(0,dom_utils_1.getParagraph)(main_1.HtmlIDs.footerError),i=e.overallError();null==i?(t.classList.remove("error"),t.textContent="Valid timetable"):(t.classList.add("error"),t.textContent=i),this.editor.applyValidationOverlay(e)}}},{"./components/header":24,"./components/new-timetable-dialog":25,"./components/paste-issues-dialog":26,"./data/export":29,"./data/timetable":37,"./data/week-day-range":38,"./dom-utils":39,"./editor/editor":44,"./main":45,"./utils":46,"./validator":47}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AltArrowsHandler=void 0;const utils_1=require("../utils"),command_handler_1=require("./command-handler");class AltArrowsHandler extends command_handler_1.CommandHandler{constructor(){super([(0,command_handler_1.keyFilter)({key:"ArrowLeft",alt:!0}),(0,command_handler_1.keyFilter)({key:"ArrowRight",alt:!0})])}handle(e,r,t,i,s,c){const l=c.editor.section,o=c.editor.grid;if(null!=l&&0!=l.width&&null!=o.selectedRange){const{x1:n,y1:d,x2:a,y2:h}=o.selectedRange;if(0==d&&h==l.height-1){if("ArrowLeft"==r&&0<n){const e=n==a?"Shift service left":"Shift services left";l.edit(e,e=>{const r=e.service(n-1);for(const r of(0,utils_1.range)(n,a+1))e.replaceService(e.service(r),r-1);e.replaceService(r,a)}),o.select(n-1,0,a-1,l.height-1)}if("ArrowRight"==r&&a<l.width-1){const e=n==a?"Shift service right":"Shift services right";l.edit(e,e=>{const r=e.service(a+1);for(const r of(0,utils_1.range)(n,a+1))e.replaceService(e.service(r),r+1);e.replaceService(r,n)}),o.select(n+1,0,a+1,l.height-1)}}}}}exports.AltArrowsHandler=AltArrowsHandler},{"../utils":46,"./command-handler":11}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CommandHandler=exports.keyFilter=void 0,exports.keyFilter=function(l){var e;return{char:null!=(e=l.char)?e:null,key:null!=(e=l.key)?e:null,ctrl:"*"==l.ctrl?null:null!=(e=l.ctrl)&&e,alt:"*"==l.alt?null:null!=(e=l.alt)&&e,shift:"*"==l.shift?null:null!=(e=l.shift)&&e}};exports.CommandHandler=class{constructor(l){this.acceptedFilters=l}}},{}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CommandListener=void 0;const select_arrows_handler_1=require("./select-arrows-handler"),tab_handler_1=require("./tab-handler"),extract_content_1=require("./extract-content"),toast_1=require("../components/toast"),enter_handler_1=require("./enter-handler"),delete_handler_1=require("./delete-handler"),select_all_handler_1=require("./select-all-handler"),undo_handler_1=require("./undo-handler"),alt_arrows_handler_1=require("./alt-arrows-handler"),text_entry_handler_1=require("./text-entry-handler"),new_service_handler_1=require("./new-service-handler"),space_handler_1=require("./space-handler"),next_day_handler_1=require("./next-day-handler"),timetable_service_1=require("../data/timetable-service");exports.CommandListener=class{constructor(e){this._appContext=e,this._handlers=[new select_arrows_handler_1.SelectArrowsHandler,new tab_handler_1.TabHandler,new enter_handler_1.EnterHandler,new delete_handler_1.DeleteHandler,new select_all_handler_1.SelectAllHandler,new undo_handler_1.UndoHandler,new alt_arrows_handler_1.AltArrowsHandler,new text_entry_handler_1.TextEntryHandler,new new_service_handler_1.NewServiceHandler,new space_handler_1.SpaceHandler,new next_day_handler_1.NextDayHandler]}onDocKeyEvent(e){this._appContext.newTimetableDialog.isOpen()||this._appContext.pasteIssuesDialog.isOpen()||"Control"!=e.key&&"Meta"!=e.key&&"Alt"!=e.key&&"Shift"!=e.key&&!this.onKey(e.key,e.code,e.ctrlKey||e.metaKey,e.altKey,e.shiftKey)||e.preventDefault()}onPaste(e){const r=this._appContext.editor.section,a=this._appContext.newTimetableDialog,l=this._appContext.pasteIssuesDialog,s=this._appContext.network;if(null!=r&&!a.isOpen()&&!l.isOpen()){var t=null!=(t=null==(t=e.clipboardData)?void 0:t.getData("text"))?t:"";if(0!=t.length){e.preventDefault();const d=r.stops.map(e=>s.stopName(e));(0,extract_content_1.extractContent)(t,d,l,(e,t)=>{d.length-t.length<=1?(0,toast_1.createToast)("That didn't seem like timetable content."):(r.edit("Paste timetable content",t=>{t.addServices(e.map(e=>new timetable_service_1.Service(e,!1)))}),3<t.length?(0,toast_1.createToast)(t.length+" stops were missing from the pasted content."):0!=t.length&&(0,toast_1.createToast)(`${t.join(", ")} ${1==t.length?"was":"were"} `+"missing from the pasted content."))}),this._appContext.editor.scrollToEnd()}}}onKey(e,t,n,r,a){const l=this._handlers.find(l=>l.acceptedFilters.some(l=>!(null!=l.char&&l.char!=e||null!=l.key&&l.key!=t||null!=l.ctrl&&l.ctrl!=n||null!=l.alt&&l.alt!=r||null!=l.shift&&l.shift!=a&&null==l.char)));return null!=l&&(l.handle(e,t,n,r,a,this._appContext),!0)}}},{"../components/toast":28,"../data/timetable-service":34,"./alt-arrows-handler":10,"./delete-handler":13,"./enter-handler":14,"./extract-content":15,"./new-service-handler":16,"./next-day-handler":17,"./select-all-handler":18,"./select-arrows-handler":19,"./space-handler":20,"./tab-handler":21,"./text-entry-handler":22,"./undo-handler":23}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DeleteHandler=void 0;const command_handler_1=require("./command-handler");class DeleteHandler extends command_handler_1.CommandHandler{constructor(){super([(0,command_handler_1.keyFilter)({key:"Delete",ctrl:"*"})])}handle(e,t,l,r,d,n){const s=n.editor.section,o=n.editor.grid;if(null!=s&&null!=o.selected){const{startX:a,startY:c,endX:i,endY:m}=o.selected;if(0!=c||m!=s.height-1||l)s.edit("Delete text",e=>{e.modifyCells(a,c,i,m,()=>"")});else{const e=a==i?"Delete service":"Delete services";s.edit(e,e=>{e.deleteServices(Math.min(a,i),Math.max(a,i)+1)}),o.clearSelection(),n.editor.refreshScroll()}}}}exports.DeleteHandler=DeleteHandler},{"./command-handler":11}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EnterHandler=void 0;const command_handler_1=require("./command-handler");class EnterHandler extends command_handler_1.CommandHandler{constructor(){super([(0,command_handler_1.keyFilter)({key:"Enter"})])}handle(e,r,n,t,d,l){const s=l.editor.section,o=l.editor.grid;if(null!=s&&null!=o.selected){const{startX:a,startY:c,endX:i,endY:m}=o.selected;s.edit("Fill empty cells",e=>{e.modifyCells(a,c,i,m,e=>""===e?"-":e)})}}}exports.EnterHandler=EnterHandler},{"./command-handler":11}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.extractContent=void 0;const utils_1=require("../utils"),timetableRowRegex=/^.+( +(([0-9]{1,2}[:.][0-9]{2}(am|pm|[uda])?)|-))+$/,timesOnlyRegex=/( +(([0-9]{1,2}[:.][0-9]{2}(am|pm|[uda])?)|-))+$/;exports.extractContent=function(t,e,n,o){!function(t,e,n,o){const r=[],s=[],i={};for(let n=0;n<e.length;n++){const o=e[n],l=t.filter(t=>t.stop===o);1==l.length?i[n]=l[0].times:0==l.length?(i[n]=null,r.push(o)):(i[n]=null,s.push({stopName:o,rowIndex:n,options:l}))}0<s.length?n.show(s,t=>{for(const e of t)i[e.rowIndex]=e.option.times;o(i,r)}):o(i,r)}(function(t,e){return(t=t.toLowerCase().replace(/[-]/g,"-")).split("\n").map(t=>t.replace(/\s+/g," ").trim()).filter(t=>timetableRowRegex.test(t)).map(t=>{var n;const o=t.split(timesOnlyRegex)[0],r=e.find(t=>function(t,e){return(t=t.toLowerCase().trim())===(e=e.toLowerCase())||t.startsWith(e)&&/^ (dep|arr|station|stn\.?|\([0-9]+\))$/g.test(t.substring(e.length))}(o,t)),s=null==(n=timesOnlyRegex.exec(t))?void 0:n.index;if(null==s)throw new Error("Row that was believed to be timetable was not in correct format");return{stop:r,times:t.substring(s).trim().split(" "),header:o}}).filter(t=>null!=t.stop)}(t,e),e,n,(t,e)=>{t=function(t){const e=Object.keys(t).map(e=>t[parseInt(e)]).filter(t=>null!=t),n=Math.max(...e.map(t=>t.length)),o=Object.keys(t).length,r=[];for(let e=0;e<o;e++){const o=t[e];for(let t=0;t<n;t++)null==r[t]&&(r[t]=[]),null==o||o.length<=t?r[t][e]="":r[t][e]=function(t){return"-"===t?"-":(t=t.replace(".",":").replace(/[ uda]\b/,""),null!=(t=(0,utils_1.standardizeTimeString)(t))?t:"?")}(o[t])}return r}(t);o(t,e)})}},{"../utils":46}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.NewServiceHandler=void 0;const timetable_service_1=require("../data/timetable-service"),utils_1=require("../utils"),command_handler_1=require("./command-handler");class NewServiceHandler extends command_handler_1.CommandHandler{constructor(){super([(0,command_handler_1.keyFilter)({key:"KeyN",shift:!0})])}handle(e,r,t,i,d,a){const l=a.editor.section;null!=l&&(l.edit("Add empty service",e=>{e.addServices([new timetable_service_1.Service((0,utils_1.repeat)("",l.height),!1)])}),a.editor.scrollToEnd())}}exports.NewServiceHandler=NewServiceHandler},{"../data/timetable-service":34,"../utils":46,"./command-handler":11}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.NextDayHandler=void 0;const utils_1=require("../utils"),command_handler_1=require("./command-handler");class NextDayHandler extends command_handler_1.CommandHandler{constructor(){super([(0,command_handler_1.keyFilter)({key:"KeyM",shift:!0})])}handle(e,t,r,n,a,d){const s=d.editor.section,l=d.editor.grid;if(null!=s&&null!=l.selected){const{startX:o,startY:i,endX:c,endY:u}=l.selected;if(0==i&&u==s.height-1){const x=s.nextDay(o);s.edit("Toggle next day",e=>{(0,utils_1.range)(o,c+1).forEach(t=>e.setNextDay(t,!x))})}}}}exports.NextDayHandler=NextDayHandler},{"../utils":46,"./command-handler":11}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SelectAllHandler=void 0;const command_handler_1=require("./command-handler");class SelectAllHandler extends command_handler_1.CommandHandler{constructor(){super([(0,command_handler_1.keyFilter)({key:"KeyA",ctrl:!0})])}handle(e,l,r,t,d,n){const c=n.editor.section,o=n.editor.grid;null!=c&&0!=c.width&&o.select(0,0,c.width-1,c.height-1)}}exports.SelectAllHandler=SelectAllHandler},{"./command-handler":11}],19:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SelectArrowsHandler=void 0;const utils_1=require("../utils"),command_handler_1=require("./command-handler");class SelectArrowsHandler extends command_handler_1.CommandHandler{constructor(){super([(0,command_handler_1.keyFilter)({key:"ArrowUp",ctrl:"*",shift:"*"}),(0,command_handler_1.keyFilter)({key:"ArrowDown",ctrl:"*",shift:"*"}),(0,command_handler_1.keyFilter)({key:"ArrowLeft",ctrl:"*",shift:"*"}),(0,command_handler_1.keyFilter)({key:"ArrowRight",ctrl:"*",shift:"*"})])}handle(e,r,t,o,l,s){const d=s.editor.section,n=s.editor.grid;if(null!=d&&0!=d.width&&null!=n.selected){let c=0,i="ArrowDown"==r?1:"ArrowUp"==r?-1:0;"ArrowLeft"==r&&(c=-1),"ArrowRight"==r&&(c=1);var{startX:s,startY:r,endX:m,endY:w}=n.selected;if(l){const e=this.coordsFromOffset(d,m,w,c,i,t);void n.select(s,r,e.x,e.y)}else{l=this.coordsFromOffset(d,s,r,c,i,t);n.select(l.x,l.y,l.x,l.y)}}}coordsFromOffset(e,r,t,o,l,s){return s&&(o*=e.width,l*=e.height),{x:(0,utils_1.clamp)(r+o,0,e.width-1),y:(0,utils_1.clamp)(t+l,0,e.height-1)}}}exports.SelectArrowsHandler=SelectArrowsHandler},{"../utils":46,"./command-handler":11}],20:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SpaceHandler=void 0;const utils_1=require("../utils"),command_handler_1=require("./command-handler");class SpaceHandler extends command_handler_1.CommandHandler{constructor(){super([(0,command_handler_1.keyFilter)({key:"Space"})])}handle(e,l,r,a,t,n){const d=n.editor.section,c=n.editor.grid;if(null!=d&&0!=d.width&&null!=c.selectedRange){const{x1:s,y1:i,y2:o}=c.selectedRange;(0,utils_1.range)(i,o+1).every(e=>""!=d.cell(s,e)&&(0,utils_1.range)(0,s).every(l=>""!=d.cell(l,e))&&(0,utils_1.range)(s+1,d.width).some(l=>""==d.cell(l,e)))&&(d.edit("Fill timetable gap",e=>{(0,utils_1.range)(i,o+1).forEach(l=>{for(let r=d.map(e=>e.times[l]).findIndex(e=>""==e)-1;r>=s;r--)e.replaceCell(r+1,l,d.cell(r,l));e.replaceCell(s,l,"-")})}),c.select(s+1,i,s+1,o))}}}exports.SpaceHandler=SpaceHandler},{"../utils":46,"./command-handler":11}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TabHandler=void 0;const command_handler_1=require("./command-handler");class TabHandler extends command_handler_1.CommandHandler{constructor(){super([(0,command_handler_1.keyFilter)({key:"Tab",shift:"*"})])}handle(e,t,s,l,d,i){var o,n,c,a,h=i.editor.section,i=i.editor.grid;null!=h&&0!=h.width&&(null==i.selected?d?this.selectCol(i,h,h.width-1):this.selectCol(i,h,0):({startX:o,startY:n,endX:c,endY:a}=i.selected,0!=n||a!=h.height-1?0!=o||c!=h.width-1?this.selectCol(i,h,o):d?this.selectRow(i,h,(n-1+h.height)%h.height):this.selectRow(i,h,(n+1)%h.height):d?this.selectCol(i,h,(o-1+h.width)%h.width):this.selectCol(i,h,(o+1)%h.width)))}selectCol(e,t,s){e.select(s,0,s,t.height-1)}selectRow(e,t,s){e.select(0,s,t.width-1,s)}}exports.TabHandler=TabHandler},{"./command-handler":11}],22:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextEntryHandler=void 0;const command_handler_1=require("./command-handler");class TextEntryHandler extends command_handler_1.CommandHandler{constructor(){super([(0,command_handler_1.keyFilter)({char:"0"}),(0,command_handler_1.keyFilter)({char:"1"}),(0,command_handler_1.keyFilter)({char:"2"}),(0,command_handler_1.keyFilter)({char:"3"}),(0,command_handler_1.keyFilter)({char:"4"}),(0,command_handler_1.keyFilter)({char:"5"}),(0,command_handler_1.keyFilter)({char:"6"}),(0,command_handler_1.keyFilter)({char:"7"}),(0,command_handler_1.keyFilter)({char:"8"}),(0,command_handler_1.keyFilter)({char:"9"}),(0,command_handler_1.keyFilter)({char:"-"}),(0,command_handler_1.keyFilter)({char:":"}),(0,command_handler_1.keyFilter)({key:"Backspace"})])}handle(e,r,a,n,d,l){const t=l.editor.section,c=l.editor.grid;if(null!=t&&null!=c.selected){const{startX:m,startY:o,endX:h,endY:_}=c.selected;m==h&&o==_||c.select(m,o),t.edit("Edit cell",a=>{"Backspace"==r?a.modifyCell(m,o,e=>0==e.length?e:e.substring(0,e.length-1)):a.modifyCell(m,o,r=>5<=r.length?r:r+e)})}}}exports.TextEntryHandler=TextEntryHandler},{"./command-handler":11}],23:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UndoHandler=void 0;const toast_1=require("../components/toast"),command_handler_1=require("./command-handler");class UndoHandler extends command_handler_1.CommandHandler{constructor(){super([(0,command_handler_1.keyFilter)({key:"KeyZ",ctrl:!0,shift:"*"}),(0,command_handler_1.keyFilter)({key:"KeyY",ctrl:!0})])}handle(e,t,o,n,r,a){const d=a.editor.section;if(null!=d){if("KeyY"==t||r){const e=d.redo();null!=e?(0,toast_1.createToast)("Redone: "+e):(0,toast_1.createToast)("Cannot redo any further")}else{const e=d.undo();null!=e?(0,toast_1.createToast)("Undone: "+e):(0,toast_1.createToast)("Cannot undo any further")}a.editor.refreshScroll()}}}exports.UndoHandler=UndoHandler},{"../components/toast":28,"./command-handler":11}],24:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Header=void 0;const week_day_range_1=require("../data/week-day-range"),dom_utils_1=require("../dom-utils"),main_1=require("../main"),generalDirNames={up:"Up",down:"Down"};exports.Header=class{constructor(e,t){this._newButton=(0,dom_utils_1.getButton)(main_1.HtmlIDs.headerNewTimetableButton),this._newButton.addEventListener("click",()=>e()),this._exportButton=(0,dom_utils_1.getButton)(main_1.HtmlIDs.headerExportButton),this._exportButton.addEventListener("click",()=>t()),this.tabs=(0,dom_utils_1.getDiv)(main_1.HtmlIDs.headerTabs)}ready(){this._newButton.disabled=!1,this._exportButton.disabled=!0,this.tabs.replaceChildren()}editing(e,t,a){this._newButton.disabled=!1,this._exportButton.disabled=!1,this.tabs.replaceChildren(...e.map(e=>function(e,t,a){const n=document.createElement("div"),r=(n.className="tab-group",n.id="tab-group-"+e,document.createElement("div")),o=(r.className="tab-group-header",document.createElement("p"));return o.textContent=generalDirNames[e]+":",r.append(o),n.append(r),n.append(...t.map(t=>function(e,t,a){const n=document.createElement("label"),r=(n.className="tab",document.createElement("input")),o=(r.type="radio",r.name="tab",r.autocomplete="off",r.value=t,r.addEventListener("click",()=>a(e,t)),document.createElement("div")),s=(o.className="tab-content",document.createElement("p"));return s.textContent=(0,week_day_range_1.nameWDR)(t),o.append(s),n.append(r,o),n}(e,t,a))),n}(e,t,a)))}selectTab(e,t){document.querySelector(`#tab-group-${e} input[value="${t}"]`).checked=!0}}},{"../data/week-day-range":38,"../dom-utils":39,"../main":45}],25:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.NewTimetableDialog=void 0;const week_day_range_1=require("../data/week-day-range"),dom_utils_1=require("../dom-utils"),main_1=require("../main"),utils_1=require("../utils");exports.NewTimetableDialog=class{constructor(e){this._dialog=document.getElementById(main_1.HtmlIDs.newTimetableDialog),this._cancelButton=(0,dom_utils_1.getButton)(main_1.HtmlIDs.newTimetableCancelButton),this._submitButton=(0,dom_utils_1.getButton)(main_1.HtmlIDs.newTimetableSubmitButton),this._linesSelect=(0,dom_utils_1.getSelect)(main_1.HtmlIDs.newTimetableLinesSelect),this._wdrsSelect=(0,dom_utils_1.getSelect)(main_1.HtmlIDs.newTimetableWDRsSelect),this._idInput=(0,dom_utils_1.getInput)(main_1.HtmlIDs.newTimetableIdInput),this._errorText=(0,dom_utils_1.getParagraph)(main_1.HtmlIDs.newTimetableErrorText),this._submittedCallback=null,this.populateInputs(e),this._cancelButton.addEventListener("click",()=>this._dialog.close()),this._submitButton.addEventListener("click",()=>this.onSubmitClick())}show(e){this._submittedCallback=e,this._dialog.showModal(),this._errorText.textContent=""}isOpen(){return 1==this._dialog.open}populateInputs(e){var t=[...e.lines].sort((e,t)=>e.name.localeCompare(t.name)).map(e=>new Option(e.name,e.id.toString())),t=(this._linesSelect.replaceChildren(...t),week_day_range_1.WDRPresets.map((e,t)=>new Option(e.map(e=>(0,week_day_range_1.nameWDR)(e)).join(", "),t.toString())));this._wdrsSelect.replaceChildren(...t);const l=t=>{var i=e.line(t);this._idInput.placeholder=t.toString(36)+"... ("+i.name+" line)"};this._linesSelect.addEventListener("change",()=>{var e=parseInt(this._linesSelect.value);l(e)}),l(parseInt(this._linesSelect.value))}onSubmitClick(){var e=this._linesSelect.value,t=this._wdrsSelect.value,i=this._idInput.value,l=parseInt(e),t=parseInt(t);try{null!=this._submittedCallback&&this._submittedCallback(l,t,i),this._dialog.close(),this._errorText.textContent=""}catch(e){this._errorText.textContent=(0,utils_1.getErrorMessage)(e)}}}},{"../data/week-day-range":38,"../dom-utils":39,"../main":45,"../utils":46}],26:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PasteIssuesDialog=void 0;const dom_utils_1=require("../dom-utils"),main_1=require("../main");exports.PasteIssuesDialog=class{constructor(){this._dialog=document.getElementById(main_1.HtmlIDs.pasteIssuesDialog),this._cancelButton=(0,dom_utils_1.getButton)(main_1.HtmlIDs.pasteIssuesCancelButton),this._submitButton=(0,dom_utils_1.getButton)(main_1.HtmlIDs.pasteIssuesSubmitButton),this._duplicatesDiv=(0,dom_utils_1.getDiv)(main_1.HtmlIDs.pasteIssuesDuplicates),this.submittedCallback=null,this.duplicates=null,this._cancelButton.addEventListener("click",()=>this._dialog.close()),this._submitButton.addEventListener("click",()=>this.onSubmitClick())}show(t,e){this.duplicates=t,this.submittedCallback=e,this._duplicatesDiv.replaceChildren(),t.forEach(t=>{const e=document.createElement("h2"),s=(e.textContent=`Multiple rows found for "${t.stopName}"`,document.createElement("div")),i=(s.className="select-wrapper",document.createElement("div")),l=(i.className="select-highlight",document.createElement("div")),a=(l.className="select-arrow",document.createElement("select"));a.id=main_1.HtmlIDs.pasteIssuesDialogSelect(t.rowIndex),a.autocomplete="off",a.replaceChildren(...t.options.map((t,e)=>{var s=t.header.endsWith(" dep");return new Option(`Use "${t.header}"`,e.toString(),s,s)})),i.append(l),s.append(a,i),this._duplicatesDiv.append(e,s)}),this._dialog.showModal()}isOpen(){return 1==this._dialog.open}onSubmitClick(){var t;null!=this.duplicates&&null!=this.submittedCallback&&(t=this.duplicates.map(t=>{var e=(0,dom_utils_1.getSelect)(main_1.HtmlIDs.pasteIssuesDialogSelect(t.rowIndex)),e=t.options[parseInt(e.value)];return{rowIndex:t.rowIndex,option:e}}),this.submittedCallback(t),this._dialog.close())}}},{"../dom-utils":39,"../main":45}],27:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StatusScreens=void 0;const main_1=require("../main"),dom_utils_1=require("../dom-utils");exports.StatusScreens=class{constructor(){this._status=(0,dom_utils_1.getDiv)(main_1.HtmlIDs.status),this._statusLoading=(0,dom_utils_1.getDiv)(main_1.HtmlIDs.statusLoading),this._statusReady=(0,dom_utils_1.getDiv)(main_1.HtmlIDs.statusReady)}ready(){this._status.classList.remove("gone"),this._statusLoading.classList.add("gone"),this._statusReady.classList.remove("gone")}editing(){this._status.classList.add("gone")}}},{"../dom-utils":39,"../main":45}],28:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createToast=void 0,exports.createToast=function(e){const t=document.getElementById("toasts"),o=document.createElement("div"),s=(o.className="toast",document.createElement("p"));s.textContent=e,o.append(s),t.append(o),setTimeout(()=>{o.remove()},1e4),document.querySelectorAll("#toasts .toast:not(:nth-last-child(-n + 5))").forEach(e=>e.remove())}},{}],29:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.exportTimetable=void 0;const timetable_validation_1=require("./timetable-validation");function kebabify(e){return e.toLowerCase().replace(/\s+/g,"-").replace(/[^0-9a-z-]/g,"_")}exports.exportTimetable=function(e,t){const n=(0,timetable_validation_1.validateTimetable)(e,t),i=t.line(e.lineID);if(n.some(e=>!e.isValid()))throw new Error("Some timetable sections are invalid");let o="";o+="[timetable]\nversion: 2\n"+`created: ${new Date(Date.now()).toISOString().split("T")[0]}
`+`id: ${e.timetableID.toFixed()}
`+`line: ${i.id.toFixed()}
`+"type: main\nbegins: *\nends: *\n";for(const a in e.sections){var r=e.sections[a],s=n[a];for(const e of[...new Set(s.directions)]){const n=i.directions.find(t=>t.id===e);if(null==n)throw new Error("Validation assumed some services ran in direction "+`"${e}" which is impossible for this line.`);o+=function(e,t,n,i){const o=e.stops.map(e=>e.toFixed().padStart(4,"0")+" "+kebabify(n.stopName(e))),a=Math.max(...o.map(e=>e.length)),r=o.map(e=>e.padEnd(a," "));let s=t.map((e,t)=>{t=i.nextDayThresholds[t];if(null==t)throw new Error("Validation failed to calculate next day thresholds for some services.");return{service:e,nextDayThreshold:t}});s=s.filter((t,n)=>i.directions[n]===e.id);for(const n of s)for(const i in e.stops){const o=e.stops[i],a=n.service.times[t.stops.indexOf(o)],s="-"===a||parseInt(i)<n.nextDayThreshold?a:">"+a;r[i]+=" "+s.padEnd(6," ")}return`
[${e.id}, ${t.wdr}]
${r.join("\n")}
`}(n,r,t,s)}}!function(e,t){const n=new Blob([e],{type:"text/plain"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}(o,`${e.timetableID.toString(36).padStart(2,"0")}-${kebabify(i.name)}.ttbl`)}},{"./timetable-validation":36}],30:[function(require,module,exports){"use strict";function getUpStopLists(t,e){const i=e.lines.find(e=>e.id===t);if(null==i)throw new Error("No line with id="+t);e=i.directions.map(t=>t.id);return function(t,e){if("linear"===t)return["up"];if("city-loop"===t)return["up-direct","up-via-loop"];if("branch"===t)return e.filter(t=>t.endsWith("-up"));throw new Error(`Route types of "${t}" are not supported.`)}(i.routeType,e).map(t=>{var e=i.directions.find(e=>e.id===t);if(null==e)throw new Error(`Expected an up direction called "${t}" on this line`);return[...e.stops]})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.linearizeStopIDs=void 0,exports.linearizeStopIDs=function(t,e){const i=getUpStopLists(t,e);if(1==i.length)return i[0];let n=0;const o=[];for(;0<i.length;)if(0===i[n].length)i.splice(n,1),n=0;else{const t=i[n][0],e=i.findIndex((e,i)=>i!==n&&1<=e.indexOf(t));-1===e?(o.push(t),i.forEach(e=>{e[0]===t&&e.splice(0,1)})):(i[n].splice(0,1),n=e)}return function(t,e,i){const n=getUpStopLists(t,e);for(const t of n){let e=-1;for(const n of t){const t=i.indexOf(n);if(-1==t||t<=e)throw new Error('Cannot find linear order of stops to form the "up" and "down" directions');e=t}}}(t,e,o),o}},{}],31:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.loadNetwork=exports.Network=void 0;const zod_1=require("zod"),Stop=zod_1.z.object({id:zod_1.z.number().int(),name:zod_1.z.string(),platforms:zod_1.z.object({id:zod_1.z.string(),name:zod_1.z.string()}).array(),urlName:zod_1.z.string()}),Line=zod_1.z.object({id:zod_1.z.number().int(),name:zod_1.z.string(),color:zod_1.z.enum(["red","yellow","green","cyan","blue","purple","pink","grey"]),service:zod_1.z.enum(["suburban","regional"]),routeType:zod_1.z.enum(["linear","city-loop","branch"]),routeLoopPortal:zod_1.z.enum(["richmond","jolimont","north-melbourne"]).optional(),directions:zod_1.z.object({id:zod_1.z.string(),name:zod_1.z.string(),stops:zod_1.z.number().int().array()}).array()}),NetworkJson=zod_1.z.object({hash:zod_1.z.string(),stops:Stop.array(),lines:Line.array()});class Network{constructor(o){this._json=o}get lines(){return this._json.lines}stopName(o){if(null==this._json)throw new Error("Network not loaded.");var r=this._json.stops.find(r=>r.id===o);if(null==r)throw new Error("No stop with id="+o);return r.name}line(o){var r=this._json.lines.find(r=>r.id==o);if(null==r)throw new Error(`No train line with the ID "${o}"`);return r}directionsForLine(o){return this.line(o).directions}toJSON(){return this._json}static fromJSON(o){o=NetworkJson.parse(o);return new Network(o)}}exports.Network=Network,exports.loadNetwork=async function(o){const r=await fetch(`https://${o}/network/v1`);if(200!=r.status)throw new Error(`"${o}" did not respond.`);var t=await r.json();try{const o=NetworkJson.parse(t);return new Network(o)}catch(o){throw new Error("The API responded in an unexpected format")}}},{zod:7}],32:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TimetableDataJson=exports.TimetableData=void 0;const zod_1=require("zod"),timetable_service_1=require("./timetable-service");exports.TimetableData=class TimetableData{constructor(e=[]){this._services=e.map(e=>e.clone())}cell(e,s){return this._services[e].times[s]}service(e){return this._services[e].clone()}nextDay(e){return this._services[e].nextDay}map(e){return this._services.map((s,t)=>e(s.clone(),t))}filter(e){return this._services.map(e=>e.clone()).filter((s,t)=>e(s,t))}addServices(e,s){null==s?this._services.push(...e.map(e=>e.clone())):this._services.splice(s,0,...e.map(e=>e.clone()))}deleteServices(e,s){null==s?this._services.splice(e,1):this._services.splice(e,s-e)}replaceService(e,s){this._services[s]=e.clone()}replaceCell(e,s,t){this._services[e].times[s]=t}modifyCell(e,s,t){this._services[e].times[s]=t(this._services[e].times[s])}modifyCells(e,s,t,i,r){for(let a=Math.min(e,t);a<=Math.max(e,t);a++)for(let e=Math.min(s,i);e<=Math.max(s,i);e++)this._services[a].times[e]=r(this._services[a].times[e],a,e)}setNextDay(e,s){this._services[e].nextDay=s}clone(){return new TimetableData(this._services)}get width(){return this._services.length}toJSON(){return{services:this._services.map(e=>e.toJSON())}}static fromJSON(e){const s=exports.TimetableDataJson.parse(e);return new TimetableData(s.services.map(e=>timetable_service_1.Service.fromJSON(e)))}},exports.TimetableDataJson=zod_1.z.object({services:timetable_service_1.ServiceJson.array()})},{"./timetable-service":34,zod:7}],33:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TimetableSection=void 0;const week_day_range_1=require("./week-day-range"),timetable_data_1=require("./timetable-data"),zod_1=require("zod");exports.TimetableSection=class TimetableSection{constructor(t,e,a){this.generalDir=t,this.wdr=(0,week_day_range_1.validateWDR)(e),this.stops=a,this._data=new timetable_data_1.TimetableData,this.undoFrames=[],this.redoFrames=[],this.changed=null}edit(t,e){for(this.undoFrames.push({actionName:t,before:this._data});10<this.undoFrames.length;)this.undoFrames.shift();this.redoFrames=[],t=this._data.clone(),e(t),this._data=t,this.changed&&this.changed()}undo(){var t=this.undoFrames.pop();return null==t?null:(this.redoFrames.push({actionName:t.actionName,after:this._data}),this._data=t.before,this.changed&&this.changed(),t.actionName)}redo(){var t=this.redoFrames.pop();return null==t?null:(this.undoFrames.push({actionName:t.actionName,before:this._data}),this._data=t.after,this.changed&&this.changed(),t.actionName)}cell(t,e){return this._data.cell(t,e)}service(t){return this._data.service(t)}nextDay(t){return this._data.nextDay(t)}map(t){return this._data.map(t)}filter(t){return this._data.filter(t)}toJSON(){return{generalDir:this.generalDir,wdr:this.wdr,stops:this.stops,data:this._data.toJSON()}}static fromJSON(t){const e=TimetableSectionJson.parse(t),a=new TimetableSection(e.generalDir,e.wdr,e.stops);return a._data=timetable_data_1.TimetableData.fromJSON(e.data),a}get width(){return this._data.width}get height(){return this.stops.length}};const TimetableSectionJson=zod_1.z.object({generalDir:zod_1.z.string(),wdr:zod_1.z.string(),stops:zod_1.z.number().int().array(),data:timetable_data_1.TimetableDataJson})},{"./timetable-data":32,"./week-day-range":38,zod:7}],34:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ServiceJson=exports.Service=void 0;const zod_1=require("zod");exports.Service=class Service{constructor(e,t){this.times=e,this.nextDay=t}clone(){return new Service([...this.times],this.nextDay)}toJSON(){return{times:this.times,nextDay:this.nextDay}}static fromJSON(e){return e=exports.ServiceJson.parse(e),new Service(e.times,e.nextDay)}},exports.ServiceJson=zod_1.z.object({times:zod_1.z.string().array(),nextDay:zod_1.z.boolean()})},{zod:7}],35:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ValidationResultsJson=exports.ValidationResults=void 0;const zod_1=require("zod"),utils_1=require("../utils");exports.ValidationResults=class ValidationResults{constructor(r,s){this.stopErrors=(0,utils_1.repeat)(null,s),this.serviceErrors=(0,utils_1.repeat)(null,r),this.nextDayThresholds=(0,utils_1.repeat)(null,r),this.directions=(0,utils_1.repeat)(null,r),this.directionsIcons=(0,utils_1.repeat)(null,r)}reportStopError(r,s){this.stopErrors[r]=s}reportServiceError(r,s){this.serviceErrors[r]=s}reportServiceDirection(r,s,e){this.directions[r]=s,this.directionsIcons[r]=e}reportNextDayThreshold(r,s){this.nextDayThresholds[r]=s}isValid(){return this.stopErrors.every(r=>null==r)&&this.serviceErrors.every(r=>null==r)&&this.directions.every(r=>null!=r)}overallError(){let e=null;if(null==(e=null==(e=null==e?null!=(r=this.stopErrors.find(r=>null!=r))?r:null:e)?null!=(r=this.serviceErrors.find(r=>null!=r))?r:null:e))return null;var r=this.stopErrors.filter(r=>null!=r).length+this.serviceErrors.filter(r=>null!=r).length-1;return 0==r?e:1==r?e+" + 1 other error":e+` + ${r} other errors`}toJSON(){return{stopErrors:this.stopErrors,serviceErrors:this.serviceErrors,nextDayThresholds:this.nextDayThresholds,directionsIcons:this.directionsIcons}}static fromJSON(r){const s=exports.ValidationResultsJson.parse(r),e=s.serviceErrors.length,t=s.stopErrors.length,o=new ValidationResults(e,t);return o.stopErrors=s.stopErrors,o.serviceErrors=s.serviceErrors,o.nextDayThresholds=s.nextDayThresholds,o.directionsIcons=s.directionsIcons,o}},exports.ValidationResultsJson=zod_1.z.object({stopErrors:zod_1.z.string().nullable().array(),serviceErrors:zod_1.z.string().nullable().array(),nextDayThresholds:zod_1.z.number().int().nullable().array(),directionsIcons:zod_1.z.string().nullable().array()})},{"../utils":46,zod:7}],36:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.validateSection=exports.validateTimetable=void 0;const utils_1=require("../utils"),timetable_validation_results_1=require("./timetable-validation-results");function validateSection(e,t,i){var r=new timetable_validation_results_1.ValidationResults(e.width,e.height);return function(e,t){for(const i of(0,utils_1.range)(0,e.height))(0,utils_1.range)(0,e.width).some(t=>""==e.cell(t,i))&&t.reportStopError(i,"Stop has missing values")}(e,r),function(e,t){for(const i of(0,utils_1.range)(0,e.width)){const r=e.service(i);for(const n of(0,utils_1.range)(0,i)){const o=e.service(n);r.nextDay==o.nextDay&&r.times.every((e,t)=>e==o.times[t])&&t.reportServiceError(i,"Duplicated service")}}}(e,r),function(e,t,i,r){var n=t.line(i);for(const t of(0,utils_1.range)(0,e.width)){const i=e.service(t),o=/^((2[0-3]|[01][0-9]):[0-5][0-9]|-)$/;if(i.times.every(e=>""==e||o.test(e))){if(!i.times.some(e=>""==e)){const o=function(e,t,i){const r=e.filter((e,i)=>"-"!=t.times[i]);if(r.length<2)return null;const n=i.filter(e=>e.stops.filter(e=>r.includes(e)).every((e,t)=>r[t]===e));return 0==n.length?null:n.sort((e,t)=>e.stops.length-t.stops.length)[0].id}(e.stops,i,n.directions);if(null==o)r.reportServiceError(t,"Service direction unrecognized");else{r.reportServiceDirection(t,o,function(e,t){return"city-loop"===t.routeType?e.endsWith("-via-loop")?t.routeLoopPortal+"-via-loop":t.routeLoopPortal+"-direct":"branch"===t.routeType&&2==t.directions.length?e===t.directions[0].id?"branch-a":"branch-b":null}(o,n));const e=function(e){const t=[];let i=0;for(let r=0;r<e.times.length;r++){var n;"-"===e.times[r]?t.push(i):(n=(0,utils_1.parseMinuteOfDay)(e.times[r]),t.push(n),i=n)}const r=[];for(let e=1;e<t.length;e++)t[e-1]>t[e]&&r.push(e);return e.nextDay&&0===r.length?0:e.nextDay||0!==r.length?e.nextDay||1!==r.length?null:r[0]:t.length}(i);null==e?r.reportServiceError(t,"Time travel required (service spans too many days)"):r.reportNextDayThreshold(t,e)}}}else r.reportServiceError(t,"Cells contain invalid values")}}(e,t,i,r),r}exports.validateTimetable=function(e,t){return e.sections.map(i=>validateSection(i,t,e.lineID))},exports.validateSection=validateSection},{"../utils":46,"./timetable-validation-results":35}],37:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Timetable=void 0;const utils_1=require("../utils"),linearize_stops_1=require("./linearize-stops"),timetable_section_1=require("./timetable-section");exports.Timetable=class{constructor(e,t,i,s){this.timetableID=(0,utils_1.validateTimetableID)(e),this.lineID=(0,utils_1.validateLineID)(t,s),this._wdrs=i,this.sections=[];e=(0,linearize_stops_1.linearizeStopIDs)(t,s);this.linearizedStops={up:e,down:[...e].reverse()},i.forEach(e=>{this.sections.push(new timetable_section_1.TimetableSection("up",e,this.linearizedStops.up)),this.sections.push(new timetable_section_1.TimetableSection("down",e,this.linearizedStops.down))})}get generalDirs(){return["up","down"]}get wdrs(){return[...this._wdrs]}getTimetableSection(e,t){var i=this.sections.find(i=>i.generalDir===e&&i.wdr===t);if(null!=i)return i;throw new Error(`Timetable section in generalDir="${e}", `+`wdr="${t}" does not exist`)}getFirstSection(){return this.getTimetableSection(this.generalDirs[0],this.wdrs[0])}hasContent(){return this.sections.some(e=>0!=e.width)}}},{"../utils":46,"./linearize-stops":30,"./timetable-section":33}],38:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.validateWDR=exports.nameWDR=exports.WDRPresets=void 0,exports.WDRPresets=[["MTWT___","____F__","_____S_","______S"],["MTWTF__","_____S_","______S"],["MTWTFSS"],["M______","_TWT___","____F__","_____S_","______S"],["M______","_TWTF__","_____S_","______S"],["M______","_T_____","__W____","___T___","____F__","_____S_","______S"]];const WDRNames={M______:"Mon",_T_____:"Tue",__W____:"Wed",___T___:"Thu",____F__:"Fri",_____S_:"Sat",______S:"Sun",MTWT___:"Mon-Thu",MTWTF__:"Mon-Fri",MTWTFSS:"Mon-Sun",_TWT___:"Tue-Thu",_TWTF__:"Tue-Fri"};exports.nameWDR=function(_){if(_ in WDRNames)return WDRNames[_];throw new Error(`Week day range value "${_}" is invalid or not supported`)},exports.validateWDR=function(_){if(/^(M|_)(T|_)(W|_)(T|_)(F|_)(S|_)(S|_)$/.test(_))return _;throw new Error(`Invalid week day range value: "${_}"`)}},{}],39:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getHtmlOther=exports.getCanvas=exports.getParagraph=exports.getInput=exports.getSelect=exports.getDiv=exports.getButton=void 0,exports.getButton=function(t){var e=document.getElementById(t);if(e instanceof HTMLButtonElement)return e;throw new Error(`"#${t}" is not a HTMLButtonElement in the DOM.`)},exports.getDiv=function(t){var e=document.getElementById(t);if(e instanceof HTMLDivElement)return e;throw new Error(`"#${t}" is not a HTMLDivElement in the DOM.`)},exports.getSelect=function(t){var e=document.getElementById(t);if(e instanceof HTMLSelectElement)return e;throw new Error(`"#${t}" is not a HTMLSelectElement in the DOM.`)},exports.getInput=function(t){var e=document.getElementById(t);if(e instanceof HTMLInputElement)return e;throw new Error(`"#${t}" is not a HTMLInputElement in the DOM`)},exports.getParagraph=function(t){var e=document.getElementById(t);if(e instanceof HTMLParagraphElement)return e;throw new Error(`"#${t}" is not a HTMLParagraphElement in the DOM`)},exports.getCanvas=function(t){var e=document.getElementById(t);if(e instanceof HTMLCanvasElement)return e;throw new Error(`"#${t}" is not a HTMLCanvasElement in the DOM`)},exports.getHtmlOther=function(t){var e=document.getElementById(t);if(null!=e)return e;throw new Error(`"#${t}" is not in the DOM.`)}},{}],40:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.css=void 0,exports.css={text:"hsla(220deg, 100%, 4%, 0.8)",paper10:"hsl(220deg, 30%, 93.5%)",accent:"#00a5ca",hoverHighlight:"hsla(220deg, 100%, 18%, 0.1)"}},{}],41:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EditorGrid=exports.editorColSize=exports.editorRowSize=void 0;const editor_grid_css_1=require("./editor-grid-css"),dom_utils_1=require("../dom-utils"),main_1=require("../main");exports.editorRowSize=20,exports.editorColSize=48;exports.EditorGrid=class{constructor(t){this._editor=t,this._grid=(0,dom_utils_1.getDiv)(main_1.HtmlIDs.editorGrid),this._canvas=(0,dom_utils_1.getCanvas)(main_1.HtmlIDs.editorGridCanvas);t=this._canvas.getContext("2d");if(null==t)throw new Error("This browser doesn't seem to support 2d canvas.");this._context=t,this._selected=null,this._dragging=!1,this._mouseOver=null,this._nextDayThresholds=[],this._canvas.addEventListener("mousedown",t=>{t=this.relativeCoords(t);this._selected={startX:t.x,startY:t.y,endX:t.x,endY:t.y},this._dragging=!0,this.draw()}),this._canvas.addEventListener("mouseup",t=>{this._dragging=!1,null!=this._selected&&(t=this.relativeCoords(t),this._selected.endX=t.x,this._selected.endY=t.y),this.draw()}),this._canvas.addEventListener("mousemove",t=>this.onMouseMove(t)),this._canvas.addEventListener("mouseenter",t=>this.onMouseMove(t)),this._canvas.addEventListener("mouseleave",()=>{this._mouseOver=null,this.draw()})}resetEvents(){this._selected=null,this._dragging=!1,this.resetMouseOver()}resetMouseOver(){this._mouseOver=null}draw(){var t,e,s;const i=this._editor.section,o=null!=(t=null==i?void 0:i.width)?t:0,r=null!=(e=null==i?void 0:i.height)?e:0,d=this.calculateDpiRatio(),l=this.getOnScreenCells(r,o);if(this._grid.style.width=exports.editorColSize*o+"px",this._grid.style.height=exports.editorRowSize*r+"px",this._canvas.width=exports.editorColSize*l.width*d,this._canvas.height=exports.editorRowSize*l.height*d,this._canvas.style.width=exports.editorColSize*l.width+"px",this._canvas.style.height=exports.editorRowSize*l.height+"px",this._canvas.style.left=exports.editorColSize*l.x1+"px",this._canvas.style.top=exports.editorRowSize*l.y1+"px",this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._context.translate(-l.x1*exports.editorColSize*d,-l.y1*exports.editorRowSize*d),this._context.scale(d,d),null!=i){this._context.fillStyle=editor_grid_css_1.css.paper10;for(let t=l.y1;t<l.y2;t++)t%2==0&&this._context.fillRect(l.x1*exports.editorColSize,t*exports.editorRowSize,l.width*exports.editorColSize,exports.editorRowSize);this._context.font="0.7rem 'Roboto Mono', monospace";for(let t=l.x1;t<l.x2;t++){const e=null!=(s=this._nextDayThresholds[t])?s:i.height;for(let s=l.y1;s<l.y2;s++){this._context.fillStyle=s<e?editor_grid_css_1.css.text:editor_grid_css_1.css.accent;const o=i.cell(t,s),r=this._context.measureText(o).width;this._context.fillText(o,t*exports.editorColSize+(exports.editorColSize-r)/2,s*exports.editorRowSize+14)}}if(this._context.fillStyle=editor_grid_css_1.css.hoverHighlight,null!=this._mouseOver&&this._context.fillRect(this._mouseOver.x*exports.editorColSize,this._mouseOver.y*exports.editorRowSize,exports.editorColSize,exports.editorRowSize),this._context.lineWidth=Math.round(1.5*d)/d,this._context.strokeStyle=editor_grid_css_1.css.accent,null!=this._selected){const t=Math.min(this._selected.startX,this._selected.endX),e=Math.max(this._selected.startX,this._selected.endX)-t+1,s=Math.min(this._selected.startY,this._selected.endY),i=Math.max(this._selected.startY,this._selected.endY)-s+1;this._context.strokeRect(t*exports.editorColSize,s*exports.editorRowSize,e*exports.editorColSize,i*exports.editorRowSize)}}}relativeCoords(t){var e=this._grid.getBoundingClientRect(),s=t.clientX-e.left,t=t.clientY-e.top;return{x:Math.floor(s/exports.editorColSize),y:Math.floor(t/exports.editorRowSize)}}onMouseMove(t){this._mouseOver=this.relativeCoords(t),this._dragging&&(1!=t.buttons?this._dragging=!1:null!=this._selected&&(this._selected.endX=this._mouseOver.x,this._selected.endY=this._mouseOver.y)),this.draw()}calculateDpiRatio(){return(window.devicePixelRatio||1)/(this._context.backingStorePixelRatio||1)}getOnScreenCells(t,e){var s=this._editor.clientSize(),i=this._editor.scrollPos(),o=s.width-this._editor.stops.clientWidth(),s=s.height-this._editor.services.clientHeight(),d=Math.max(0,Math.floor(i.y/exports.editorRowSize)),t=Math.min(t,d+Math.ceil(s/exports.editorRowSize)+1),s=t-d,i=Math.max(0,Math.floor(i.x/exports.editorColSize)),e=Math.min(e,i+Math.ceil(o/exports.editorColSize)+1);return{x1:i,x2:e,y1:d,y2:t,width:e-i,height:s}}get selected(){return null==this._selected?null:Object.assign({},this._selected)}get selectedRange(){return null==this._selected?null:{x1:Math.min(this._selected.startX,this._selected.endX),y1:Math.min(this._selected.startY,this._selected.endY),x2:Math.max(this._selected.startX,this._selected.endX),y2:Math.max(this._selected.startY,this._selected.endY)}}select(t,e,s,i){this._selected={startX:t,startY:e,endX:null!=s?s:t,endY:null!=i?i:e},this.draw()}clearSelection(){this._selected=null,this.draw()}setNextDayThresholds(t){this._nextDayThresholds=t,this.draw()}}},{"../dom-utils":39,"../main":45,"./editor-grid-css":40}],42:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EditorServices=void 0;const dom_utils_1=require("../dom-utils"),main_1=require("../main");exports.EditorServices=class{constructor(){this._servicesDiv=(0,dom_utils_1.getDiv)(main_1.HtmlIDs.editorServices),this._currNextDay=[],this.serviceClicked=null}clear(){this.setServices([])}setServices(e){e.length==this._currNextDay.length&&e.every((e,i)=>this._currNextDay[i]==e)||(this._currNextDay=e,this._servicesDiv.replaceChildren(...e.map(e=>this.makeButton(e))))}markErrorServices(e){this._servicesDiv.querySelectorAll(".service").forEach((i,r)=>{e[r]?i.classList.add("error"):i.classList.remove("error")})}markServiceDirectionIcons(e){this._servicesDiv.querySelectorAll(".service .direction-icon").forEach((i,r)=>{const t=i;null==e[r]?t.classList.add("gone"):(t.src=`service-icons/${e[r]}.svg`,t.classList.remove("gone"))})}makeButton(e){const i=document.createElement("button"),r=(i.className="service",document.createElement("img"));if(r.className="direction-icon gone",r.alt="Service direction indicator",i.append(r),e){const e=document.createElement("img");e.src="service-icons/next-day.svg",e.alt="Next day",i.append(e)}return i.addEventListener("click",()=>{if(null!=this.serviceClicked){var e=i.parentElement;if(null==e)throw new Error("Clicked service button had no parent");e=Array.from(e.children).indexOf(i);this.serviceClicked(e)}}),i}clientHeight(){return this._servicesDiv.getBoundingClientRect().height}}},{"../dom-utils":39,"../main":45}],43:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EditorStops=void 0;const dom_utils_1=require("../dom-utils"),main_1=require("../main");exports.EditorStops=class{constructor(){this._stopsDiv=(0,dom_utils_1.getDiv)(main_1.HtmlIDs.editorStops),this.stopClicked=null}clear(){this.setStops([])}setStops(t){this._stopsDiv.replaceChildren(...t.map((t,e)=>{const s=document.createElement("button"),o=(s.className="stop",document.createElement("p"));return o.textContent=t,s.append(o),s.addEventListener("click",()=>{null!=this.stopClicked&&this.stopClicked(e)}),s}))}markErrorStops(t){this._stopsDiv.querySelectorAll(".stop").forEach((e,s)=>{t[s]?e.classList.add("error"):e.classList.remove("error")})}clientWidth(){return this._stopsDiv.getBoundingClientRect().width}}},{"../dom-utils":39,"../main":45}],44:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Editor=void 0;const dom_utils_1=require("../dom-utils"),main_1=require("../main"),utils_1=require("../utils"),editor_grid_1=require("./editor-grid"),editor_services_1=require("./editor-services"),editor_stops_1=require("./editor-stops");exports.Editor=class{constructor(i){this.section=null,this.grid=new editor_grid_1.EditorGrid(this),this.stops=new editor_stops_1.EditorStops,this.services=new editor_services_1.EditorServices,this._editorDiv=(0,dom_utils_1.getHtmlOther)(main_1.HtmlIDs.editor),this._validationTimeoutID=null,this._validationRequestCallback=i,this._editorDiv.addEventListener("scroll",()=>{this.grid.resetMouseOver(),this.grid.draw()});i=i=>this.onScrollWheel(i);this._editorDiv.addEventListener("mousewheel",i,!1),this._editorDiv.addEventListener("DOMMouseScroll",i,!1),this.stops.stopClicked=i=>this.onStopClicked(i),this.services.serviceClicked=i=>this.onServiceClicked(i),this.grid.draw()}resize(){this.grid.resetMouseOver(),this.grid.draw()}clear(){null!=this.section&&(this.section.changed=null),this.section=null,this.stops.clear(),this.services.clear(),this.grid.resetEvents(),this.grid.setNextDayThresholds([]),this.grid.draw()}setSection(i,t){null!=this.section&&(this.section.changed=null),this.section=i,this.stops.setStops(i.stops.map(i=>t.stopName(i))),this.services.setServices(this.section.map(i=>i.nextDay)),this._editorDiv.scrollLeft=0,this.section.changed=()=>this.onChanged(),this.grid.resetEvents(),this.grid.draw(),this._validationRequestCallback(i)}applyValidationOverlay(i){const t=this.section;null!=t&&(this.stops.markErrorStops(i.stopErrors.map(i=>null!=i)),this.services.markErrorServices(i.serviceErrors.map(i=>null!=i)),this.services.markServiceDirectionIcons(i.directionsIcons),this.grid.setNextDayThresholds(i.nextDayThresholds.map(i=>null==i?t.height:i)))}onChanged(){null!=this.section&&(this.grid.draw(),this.services.setServices(this.section.map(i=>i.nextDay)),null!=this._validationTimeoutID&&(clearTimeout(this._validationTimeoutID),this._validationTimeoutID=null),this._validationTimeoutID=setTimeout(()=>{null!=this.section&&this._validationRequestCallback(this.section)},500))}onServiceClicked(i){null!=this.section&&this.grid.select(i,0,i,this.section.height-1)}onStopClicked(i){null!=this.section&&0!=this.section.width&&this.grid.select(0,i,this.section.width-1,i)}onScrollWheel(i){var t=i=window.event||i,t=(0,utils_1.clamp)(t.wheelDelta||-t.detail,-1,1);this._editorDiv.scrollLeft-=64*t,i.preventDefault()}clientSize(){return this._editorDiv.getBoundingClientRect()}scrollPos(){return{x:this._editorDiv.scrollLeft,y:this._editorDiv.scrollTop}}scrollToEnd(){var i=(null!=(i=null==(i=this.section)?void 0:i.width)?i:0)*editor_grid_1.editorColSize;this._editorDiv.scrollLeft=i}refreshScroll(){var i=(null!=(i=null==(i=this.section)?void 0:i.width)?i:0)*editor_grid_1.editorColSize;this._editorDiv.scrollLeft=Math.min(this._editorDiv.scrollLeft,i)}}},{"../dom-utils":39,"../main":45,"../utils":46,"./editor-grid":41,"./editor-services":42,"./editor-stops":43}],45:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HtmlIDs=exports.validationWorkerScriptName=exports.apiDomain=void 0;const network_1=require("./data/network"),command_listener_1=require("./commands/command-listener"),app_context_1=require("./app-context"),status_screens_1=require("./components/status-screens");exports.apiDomain="api.trainquery.com",exports.validationWorkerScriptName="validation-worker.js";class HtmlIDs{static pasteIssuesDialogSelect(e){return"paste-issues-dialog-duplicate-"+e}}(exports.HtmlIDs=HtmlIDs).editor="editor",HtmlIDs.editorGrid="grid",HtmlIDs.editorGridCanvas="grid-canvas",HtmlIDs.editorStops="stops",HtmlIDs.editorServices="services",HtmlIDs.headerNewTimetableButton="new-timetable-button",HtmlIDs.headerExportButton="export-button",HtmlIDs.headerTabs="tabs",HtmlIDs.status="status",HtmlIDs.statusLoading="status-loading",HtmlIDs.statusReady="status-ready",HtmlIDs.newTimetableDialog="new-timetable-dialog",HtmlIDs.newTimetableCancelButton="new-timetable-dialog-cancel",HtmlIDs.newTimetableSubmitButton="new-timetable-dialog-submit",HtmlIDs.newTimetableLinesSelect="new-timetable-dialog-lines",HtmlIDs.newTimetableWDRsSelect="new-timetable-dialog-wdrs",HtmlIDs.newTimetableIdInput="new-timetable-dialog-id",HtmlIDs.newTimetableErrorText="new-timetable-dialog-error",HtmlIDs.pasteIssuesDialog="paste-issues-dialog",HtmlIDs.pasteIssuesCancelButton="paste-issues-dialog-cancel",HtmlIDs.pasteIssuesSubmitButton="paste-issues-dialog-submit",HtmlIDs.pasteIssuesDuplicates="paste-issues-dialog-duplicates",HtmlIDs.footerError="footer-error";const status=new status_screens_1.StatusScreens;(0,network_1.loadNetwork)(exports.apiDomain).then(e=>{const t=new app_context_1.AppContext(e,status),s=new command_listener_1.CommandListener(t);document.addEventListener("keydown",e=>s.onDocKeyEvent(e)),document.addEventListener("paste",e=>s.onPaste(e)),window.addEventListener("resize",()=>t.editor.resize()),window.onbeforeunload=()=>{if(null!=t.timetable&&t.timetable.hasContent())return!0}})},{"./app-context":9,"./commands/command-listener":12,"./components/status-screens":27,"./data/network":31}],46:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getErrorMessage=exports.standardizeTimeString=exports.parseMinuteOfDay=exports.repeat=exports.range=exports.clamp=exports.validateLineID=exports.validateTimetableID=void 0,exports.validateTimetableID=function(e){if(isNaN(e))throw new Error("No timetable ID given");if(1295<e||e<0)throw new Error("Timetable ID must be 0-1295 to fit within two base-36 "+`digits (given ${e})`);return e},exports.validateLineID=function(e,t){if(t.lines.some(t=>t.id===e))return e;throw new Error("There is no line with id="+e)},exports.clamp=function(e,t,r){var a=Math.min(t,r),t=Math.max(t,r);return Math.min(Math.max(e,a),t)},exports.range=function(e,t){return[...Array(t-e).keys()].map(t=>t+e)},exports.repeat=function(e,t){const r=[];for(let a=0;a<t;a++)r.push(e);return r},exports.parseMinuteOfDay=function(e){var t=e.split(":"),r=parseInt(t[0]),t=parseInt(t[1]);if(isNaN(r)||isNaN(t)||r<0||t<0||23<r||59<t)throw new Error(`"${e}" is not a valid time of day`);return 60*r+t},exports.standardizeTimeString=function(e){if(!/^[0-9]{1,2}:[0-9]{2}(am|pm)?$/g.test(e))return null;const t=e.split(":");let r=parseInt(t[0]);const a=parseInt(t[1].replace("am","").replace("pm",""));return(e.endsWith("am")||e.endsWith("pm"))&&(r%=12,e.endsWith("pm")&&(r+=12)),r<0||24<=r||a<0||60<=a?null:r.toFixed().padStart(2,"0")+":"+a.toFixed().padStart(2,"0")},exports.getErrorMessage=function(e){return e instanceof Error?e.message:"Something went wrong"}},{}],47:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Validator=void 0;const timetable_validation_results_1=require("./data/timetable-validation-results"),main_1=require("./main");exports.Validator=class{constructor(t,e){this._worker=new Worker(main_1.validationWorkerScriptName),this.resultsCallback=e,this._worker.postMessage({network:t.toJSON()}),this._worker.onmessage=t=>{this.resultsCallback(timetable_validation_results_1.ValidationResults.fromJSON(t.data))}}requestValidation(t,e){this._worker.postMessage({section:t.toJSON(),lineID:e})}}},{"./data/timetable-validation-results":35,"./main":45}]},{},[45]);
